{"config":{"lang":["en"],"separator":"[\\s\\-\\.]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u8ba1\u7b97\u673a\u7ec4\u6210 | Computer Organization","text":"<p> \u7ea6 168 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <p>\u8bfe\u7a0b\u57fa\u672c\u4fe1\u606f</p> <ul> <li>\u8bfe\u7a0b\u540d\u79f0\uff1a\u8ba1\u7b97\u673a\u7ec4\u6210</li> <li>\u8bfe\u7a0b\u4ee3\u7801\uff1a<code>21186033</code></li> </ul> <p>\u8d44\u6e90\u76ee\u5f55</p> <ul> <li>1 \u5199\u5728\u524d\u9762&amp;\u6982\u8ff0</li> <li>2 \u6307\u4ee4 | Instructions</li> <li>3 \u7b97\u672f | Arithmetic</li> <li>4 \u5904\u7406\u5668 | Processor</li> <li>5 \u7f13\u5b58 | Cache</li> <li>6 \u8f93\u5165/\u8f93\u51fa | I/O</li> <li>\u9644\u5f55:<ul> <li>A \u5386\u5e74\u5377</li> </ul> </li> </ul> <p>TODOs</p> <ul> <li> \u8fc1\u79fb\uff1b</li> <li> \u66f4\u591a\u7ec3\u4e60\u9898\uff1b</li> <li> \u8d44\u6e90\u9875\u4ee5\u53ca\u5176\u4ed6\u8d44\u6e90\uff08\u4f8b\u5982\u5386\u5e74\u5377\u3001\u62d3\u5c55\u9605\u8bfb\u7b49\uff0c\u76ee\u524d\u5df2\u7ecf\u6709\u4e00\u90e8\u5206\uff0c\u4f46\u5e94\u5f53\u8bbe\u8ba1\u4e00\u4e2a\u66f4\u597d\u7684\u9648\u5217\u65b9\u5f0f\uff09\uff1b</li> <li> \u914d\u56fe\u66f4\u6362\uff08\u76ee\u6807\u662f\u8ba9\u6240\u6709\u914d\u56fe\u90fd\u53d8\u6210\u66f4\u597d\u770b\u7684\u3001\u4e0d\u5bb9\u6613\u5f15\u8d77\u7248\u6743\u95ee\u9898\u7684\u56fe\uff09\uff1b</li> </ul> <p>\u672c\u6587\u6863\u8fc1\u79fb\u81ea \u8ba1\u7b97\u673a\u7ec4\u6210 | \u54b8\u9c7c\u6684\u7684\u4ee3\u7801\u7a7a\u95f4\u3002</p>"},{"location":"1-x/","title":"1 \u5199\u5728\u524d\u9762 &amp; \u6982\u8ff0","text":"<p> \u7ea6 375 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p> <p>\u6211\u7684\u7b14\u8bb0\u6240\u8ffd\u6c42\u7684\u76ee\u6807\u662f\u6709\u903b\u8f91\u3001\u901a\u7545\u5730\u603b\u7ed3\u77e5\u8bc6\uff1b\u56e0\u6b64\u5982\u679c\u60a8\u5728\u9605\u8bfb\u8fc7\u7a0b\u4e2d\u5728\u4efb\u4f55\u5730\u65b9\u53d1\u73b0\u4e86\u4e0d\u5bb9\u6613\u8bfb\u61c2\u7684\u90e8\u5206\uff0c\u8bf7\u52a1\u5fc5\u5728\u8bc4\u8bba\u533a\u6216\u8005\u901a\u8fc7\u5176\u5b83\u65b9\u5f0f\u544a\u77e5\u6211QWQ\uff01\u975e\u5e38\u611f\u8c22\uff01</p> <p>\u8fd9\u662f\u8ba1\u7b97\u673a\u7ec4\u6210\u8bfe\u7a0b\u7684\u5b66\u4e60\u8bb0\u5f55\u3002</p> <p>\u4f7f\u7528\u7684\u8bfe\u672c\u662f Computer Organization and Design - The Hardware / Software Interface (RISC-V Edition)\uff1a</p> <p></p> <p>\u8bf4\u660e</p> <p>\u6211\u81ea\u8ba4\u4e3a\u5728 3 Arithmetic, 4 Processor, 5 Cache \u4e09\u7ae0\u4e2d\u7684\u6574\u7406\u548c\u8bb2\u89e3\u662f\u975e\u5e38\u8be6\u7ec6\u7684\uff0c\u5982\u679c\u8fd9\u4e9b\u90e8\u5206\u5b58\u5728\u770b\u4e0d\u61c2\u7684\u5730\u65b9\uff0c\u8bf7\u52a1\u5fc5\u8054\u7cfb\u6211\u3002</p> <p>\u4f46\u662f\uff0c\u8ba1\u7ec4\u8bfe\u7a0b\u672c\u8eab\u5728 2 Instructions \u7684\u90e8\u5206\u8bb2\u89e3\u4e86\u5f88\u591a\u5173\u4e8e\u6c47\u7f16\u7a0b\u5e8f\u7684\u77e5\u8bc6\uff1b\u4f46\u662f\u6211\u4e4b\u524d\u5728\u6c47\u7f16\u8bed\u8a00\u548c\u8ba1\u7b97\u673a\u7cfb\u7edf\u6982\u8bba\u7b49\u8bfe\u7a0b\u4e2d\u5df2\u7ecf\u5b66\u4e60\u8fc7\u4e86\u8fd9\u4e9b\u77e5\u8bc6\uff0c\u56e0\u6b64\u5728\u672c\u7ae0\u4e2d\u53ea\u6574\u7406\u4e86 RISC-V \u7684\u6307\u4ee4\u96c6\u548c\u4e00\u4e9b\u7ea6\u5b9a\uff0c\u7701\u7565\u4e86\u5173\u4e8e\u51fd\u6570\u8c03\u7528\u3001\u9012\u5f52\u7684\u4e00\u4e9b\u5185\u5bb9\u3002</p> <p>\u540c\u65f6\uff0c\u7531\u4e8e\u65f6\u95f4\u539f\u56e0\uff0c1 Overview \u548c 6 I/O \u4e24\u7ae0\u7684\u5185\u5bb9\u4e0d\u5b8c\u6574\u3002\u6682\u65f6\u6ca1\u6709\u8865\u5168\u8ba1\u5212\u3002</p>"},{"location":"1-x/#1-intro--misc","title":"1 Intro &amp; Misc","text":"<ul> <li>Moore's Law: Integrated circuit resources double every 18-24 months.</li> <li>KB = 103 B, KiB = 210 B</li> <li>K M G T P E Z Y</li> <li>Response Time / Execution Time    \u4ece\u7a0b\u5e8f\u5f00\u59cb\u5230\u7ed3\u675f\u7684\u65f6\u95f4</li> <li>Throughput / Bandwidth    \u5355\u4f4d\u65f6\u95f4\u5185\u5b8c\u6210\u7684\u4efb\u52a1\u6570\u91cf</li> <li>Performance   \u53ef\u4ee5\u5b9a\u4e49\u4e3a \\(\\cfrac{1}{\\text{Response Time}}\\)</li> <li>Amdahl Law \\(T_{\\text{improved}} = \\cfrac{T_{\\text{affected}}}{\\text{Improvement Factor}}+T_\\text{unaffected}\\)</li> <li>\u2026\u2026\u4e0d\u662f\u5f88\u60f3\u5b66\u4e86 \u518d\u8bf4\u5427</li> </ul>"},{"location":"2-x/","title":"2 \u6307\u4ee4 | Instructions","text":"<p> \u7ea6 1569 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>Warning</p> <p>\u672c\u7ae0\u90e8\u5206\u5185\u5bb9\u5efa\u7acb\u5728\u638c\u63e1\u81f3\u5c11\u4e00\u95e8\u6c47\u7f16\u8bed\u8a00\u7684\u57fa\u7840\u4e0a\uff0c\u4f8b\u5982\u4fee\u8bfb\u8fc7\u8ba1\u7b97\u673a\u7cfb\u7edf\u6982\u8bba\u6216\u6c47\u7f16\u8bed\u8a00\u7b49\u8bfe\u7a0b\u3002</p> <p>\u6211\u4eec\u8ba8\u8bba\u8fc7\uff0c\u8ba1\u7b97\u673a\u7684 performance \u53d7 inst#, clock cycle time \u548c clock cycles per inst (CPI) \u51b3\u5b9a\u3002\u7ed9\u5b9a\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u9700\u8981\u4f7f\u7528\u7684 inst# \u53d7\u7f16\u8bd1\u5668\u548c inst set architecture \u51b3\u5b9a\u3002</p> <p>\u672c\u7ae0\u4ecb\u7ecd RISC-V \u7684 ISA\u3002</p>"},{"location":"2-x/#21-\u5bc4\u5b58\u5668\u5bfb\u5740\u65b9\u5f0f","title":"2.1 \u5bc4\u5b58\u5668\uff0c\u5bfb\u5740\u65b9\u5f0f","text":""},{"location":"2-x/#\u5bc4\u5b58\u5668","title":"\u5bc4\u5b58\u5668","text":"<p>RISC-V architecture \u63d0\u4f9b 32 \u4e2a\u6570\u636e\u5bc4\u5b58\u5668\uff0c\u5206\u522b\u547d\u540d\u4e3a <code>x0</code> ~ <code>x31</code> \uff0c\u6bcf\u4e2a\u5bc4\u5b58\u5668\u7684\u5927\u5c0f\u662f <code>64</code> \u4f4d\u3002\u5728 RISC-V architecture \u4e2d\uff0c\u4e00\u4e2a word \u4e3a 32 \u4f4d\uff0c\u4e00\u4e2a doubleword \u4e3a 64 \u4f4d\u3002\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4e2d\u7684\u4e00\u90e8\u5206\u6709\u4e13\u95e8\u7684\u7528\u9014\uff0c\u6211\u4eec\u7a0d\u540e\u5bf9\u5176\u8fdb\u884c\u8ba8\u8bba\u3002</p> <p>RISC-V architecture \u4e5f\u63d0\u4f9b\u4e00\u7cfb\u5217\u6d6e\u70b9\u6570\u5bc4\u5b58\u5668 <code>f0</code> ~ <code>f31</code> \uff0c\u8fd9\u4e0d\u662f\u6211\u4eec\u8ba8\u8bba\u7684\u91cd\u70b9\u3002</p>"},{"location":"2-x/#\u5bfb\u5740","title":"\u5bfb\u5740","text":"<p>RISC-V architecture \u7684\u5730\u5740\u662f 64 \u4f4d\u7684\uff0c\u5730\u5740\u4e3a\u5b57\u8282\u5730\u5740\uff0c\u56e0\u6b64\u603b\u5171\u53ef\u4ee5\u5bfb\u5740 \\(2^{64}\\) \u4e2a\u5b57\u8282\uff0c\u5373 \\(2^{61}\\) \u4e2a dword (doubleword, \u4e0b\u540c)\u3002</p> <p>\u5728\u4e00\u4e9b architecture \u4e2d\uff0cword \u7684\u8d77\u59cb\u5730\u5740\u5fc5\u987b\u662f word \u5927\u5c0f\u7684\u6574\u500d\u6570\uff0cdword \u4e5f\u4e00\u6837\uff0c\u8fd9\u79cd\u8981\u6c42\u79f0\u4e3a alignment restriction\u3002RISC-V \u5141\u8bb8\u4e0d\u5bf9\u9f50\u7684\u5bfb\u5740\uff0c\u4f46\u662f\u6548\u7387\u4f1a\u4f4e\u3002</p> <p>RISC-V \u4f7f\u7528 little endian \u5c0f\u7aef\u7f16\u5740\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u6211\u4eec\u4ece 0x1000 \u8fd9\u4e2a\u5730\u5740\u8bfb\u51fa\u4e00\u4e2a dword \u65f6\uff0c\u6211\u4eec\u8bfb\u5230\u7684\u5b9e\u9645\u4e0a\u662f 0x1000~0x1007 \u8fd9 8 \u4e2a\u5b57\u8282\uff0c\u5e76\u5c06 0x1000 \u5b58\u5165\u5bc4\u5b58\u5668\u5730\u4f4d\uff0c0x1007 \u5b58\u5165\u9ad8\u4f4d\u3002</p> <p>RISC-V \u652f\u6301 PC relative \u5bfb\u5740\u3001\u7acb\u5373\u6570\u5bfb\u5740 ( <code>lui</code> )\u3001\u95f4\u63a5\u5bfb\u5740 ( <code>jalr</code> )\u3001\u57fa\u5740\u5bfb\u5740 ( <code>8(sp)</code> )\uff1a</p> <p></p>"},{"location":"2-x/#\u8865\u7801-2s-complement","title":"\u8865\u7801 2's complement","text":"<p>\\(x + \\bar x = 111\\dots111_2 = -1\\)\uff0c\u56e0\u6b64 \\(-x = \\bar x + 1\\)\u3002\u524d\u5bfc 0 \u8868\u793a\u6b63\u6570\uff0c\u524d\u5bfc 1 \u8868\u793a\u8d1f\u6570\u3002See also</p> <p>\u56e0\u6b64\u5728\u5c06\u4e0d\u8db3 64 \u4f4d\u7684\u6570\u636e\u8f7d\u5165\u5bc4\u5b58\u5668\u65f6\uff0c\u5982\u679c\u6570\u636e\u662f\u65e0\u7b26\u53f7\u6570\uff0c\u53ea\u9700\u8981\u4f7f\u7528 0 \u5c06\u5bc4\u5b58\u5668\u7684\u5176\u4ed6\u90e8\u5206\u586b\u5145 (zero extension)\uff1b\u800c\u5982\u679c\u662f\u7b26\u53f7\u6570\uff0c\u5219\u9700\u8981\u7528\u6700\u9ad8\u4f4d\u5373\u7b26\u53f7\u4f4d\u586b\u5145\u5269\u4f59\u90e8\u5206\uff0c\u79f0\u4e3a\u7b26\u53f7\u6269\u5c55 (sign extension)\u3002</p> <p>\u5373\uff0c\u5728\u6307\u4ee4\u4e2d\u7684 <code>lw</code> ,  <code>lh</code> ,  <code>lb</code> \u4f7f\u7528 sign extension\uff0c\u800c <code>lwu</code> ,  <code>lhu</code> ,  <code>lbu</code> \u4f7f\u7528 zero extension\u3002</p> <p>18~19 Final</p> <p></p> \u7b54\u6848 <p>-0x52F00000, -0x0FFFFCDF</p>"},{"location":"2-x/#22-\u6307\u4ee4\u6307\u4ee4\u683c\u5f0f","title":"2.2 \u6307\u4ee4\uff0c\u6307\u4ee4\u683c\u5f0f","text":"<p>\u8bfe\u672c\u4e0a\u4ecb\u7ecd\u7684 RISC-V \u6307\u4ee4\uff08 <code>lr.d</code> ,  <code>sc.d</code> \u88ab\u7701\u7565\u4e86\uff09\u5217\u8868\u5982\u4e0b\uff1a</p> <p> RISC-V \u7684\u8df3\u8f6c\u6307\u4ee4\u7684 offset \u662f\u57fa\u4e8e\u5f53\u524d\u6307\u4ee4\u7684\u5730\u5740\u7684\u504f\u79fb\uff1b\u8fd9\u4e0d\u540c\u4e8e\u5176\u4ed6\u4e00\u4e9b\u6c47\u7f16\u662f\u57fa\u4e8e\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u504f\u79fb\u7684\u3002\u5373\u5982\u679c\u662f\u8df3\u8f6c\u8bed\u53e5 <code>PC</code> \u5c31\u4e0d +4 \u4e86\uff0c\u800c\u662f\u76f4\u63a5 +offset\u3002</p> <p><code>lw</code> ,  <code>lwu</code> \u7b49\u64cd\u4f5c\u90fd\u4f1a\u6e05\u96f6\u9ad8\u4f4d\u3002</p> <p>RISC-V \u6307\u4ee4\u683c\u5f0f\u5982\u4e0b\uff1a</p> <p> \u5176\u4e2d <code>I</code> \u578b\u6307\u4ee4\u6709\u4e24\u4e2a\u6761\u76ee\uff1b\u8fd9\u662f\u56e0\u4e3a\u7acb\u5373\u6570\u79fb\u4f4d\u64cd\u4f5c <code>slli</code> , <code>srli</code> , <code>srai</code> \u5e76\u4e0d\u53ef\u80fd\u5bf9\u4e00\u4e2a 64 \u4f4d\u5bc4\u5b58\u5668\u8fdb\u884c\u5927\u4e8e 63 \u4f4d\u7684\u79fb\u4f4d\u64cd\u4f5c\uff0c\u56e0\u6b64 12 \u4f4d imm \u4e2d\u53ea\u6709\u540e 6 \u4f4d\u80fd\u5b9e\u9645\u88ab\u7528\u5230\uff0c\u56e0\u6b64\u524d\u9762 6 \u4f4d\u88ab\u7528\u6765\u4f5c\u4e3a\u4e00\u4e2a\u989d\u5916\u7684\u64cd\u4f5c\u7801\u5b57\u6bb5\uff0c\u5982\u4e0a\u56fe\u4e2d\u7b2c\u4e8c\u4e2a <code>I</code> \u6761\u76ee\u90a3\u6837\u3002\u5176\u4ed6 <code>I</code> \u578b\u6307\u4ee4\u9002\u7528\u7b2c\u4e00\u4e2a <code>I</code> \u6761\u76ee\u3002</p> <p>\u53e6\u5916\uff0c\u4e3a\u4ec0\u4e48 <code>SB</code> \u548c <code>UJ</code> \u4e0d\u5b58\u7acb\u5373\u6570\uff08\u4e5f\u5c31\u662f\u504f\u79fb\uff09\u7684\u6700\u4f4e\u4f4d\u5462\uff1f\u56e0\u4e3a\uff0c\u504f\u79fb\u7684\u6700\u540e\u4e00\u4f4d\u4e00\u5b9a\u662f 0\uff0c\u5373\u5730\u5740\u4e00\u5b9a\u662f 2 \u5b57\u8282\u5bf9\u9f50\u7684\uff0c\u56e0\u6b64\u6ca1\u6709\u5fc5\u8981\u4fdd\u5b58\u3002</p> \u65e2\u7136\u6bcf\u4e2a\u6307\u4ee4\u90fd\u662f 4 \u5b57\u8282\u5bf9\u9f50\u7684\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u662f\u6700\u540e\u4e24\u4f4d\u90fd\u7701\u7565\uff0c\u800c\u662f\u53ea\u7701\u7565\u4e00\u4f4d\u5462\uff1f <p>\u5b9e\u9645\u4e0a\uff0c\u662f\u5b58\u5728\u6307\u4ee4\u957f\u4e3a 2 \u5b57\u8282\u7684 extension \u7684\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u6ca1\u5b66\uff1a</p> <p></p> <p>\u8bfe\u672c P116</p> <p></p> <p>RISC-V Spec V20191213 P15</p>"},{"location":"2-x/#23-\u4f2a\u6307\u4ee4\u53ca\u5176\u5b9e\u73b0","title":"2.3 \u4f2a\u6307\u4ee4\u53ca\u5176\u5b9e\u73b0","text":"<p>\u6ce8\uff1a <code>j imm</code> \u4e5f\u53ef\u4ee5\u7528 <code>beq x0, x0, imm</code> \u5b9e\u73b0\uff0c\u4f46\u662f\u6b64\u6cd5\u7684 <code>imm</code> \u7684\u4f4d\u6570\u4f1a\u8f83\u77ed\uff0c\u6240\u4ee5\u4e0d\u91c7\u7528\u3002</p>"},{"location":"2-x/#24-\u5206\u652f\u548c\u5faa\u73af","title":"2.4 \u5206\u652f\u548c\u5faa\u73af","text":"<p>\u7565</p>"},{"location":"2-x/#25-\u8fc7\u7a0b\u8c03\u7528\u548c\u6808","title":"2.5 \u8fc7\u7a0b\u8c03\u7528\u548c\u6808","text":"<p>RISC-V \u7ea6\u5b9a\uff1a</p> <ul> <li><code>x5</code> - <code>x7</code> \u4ee5\u53ca <code>x28</code> - <code>x31</code> \u662f temp reg\uff0c\u5982\u679c\u9700\u8981\u7684\u8bdd caller \u4fdd\u5b58\uff1b\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u4fdd\u8bc1\u5728\u7ecf\u8fc7\u8fc7\u7a0b\u8c03\u7528\u4e4b\u540e\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u4e0d\u53d8\u3002</li> <li><code>x8</code> - <code>x9</code> \u548c <code>x18</code> - <code>x27</code> \u662f saved reg\uff0ccallee \u9700\u8981\u4fdd\u8bc1\u8c03\u7528\u524d\u540e\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u4e0d\u53d8\uff1b\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c callee \u8981\u7528\u5230\u8fd9\u4e9b\u5bc4\u5b58\u5668\uff0c\u5fc5\u987b\u4fdd\u5b58\u4e00\u4efd\uff0c\u8fd4\u56de\u524d\u6062\u590d\u3002</li> <li><code>x10</code> - <code>x17</code> \u662f 8 \u4e2a\u53c2\u6570\u5bc4\u5b58\u5668\uff0c\u51fd\u6570\u8c03\u7528\u7684\u524d 8 \u4e2a\u53c2\u6570\u4f1a\u653e\u5728\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4e2d\uff1b\u5982\u679c\u53c2\u6570\u8d85\u8fc7 8 \u4e2a\u7684\u8bdd\u5c31\u9700\u8981\u653e\u5230\u6808\u4e0a\uff08\u653e\u5728 <code>fp</code> \u4e0a\u65b9\uff0c <code>fp + 8</code> \u662f\u7b2c 9 \u4e2a\u53c2\u6570\uff0c <code>fp + 16</code> \u7684\u7b2c 10 \u4e2a\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff09\u3002\u540c\u65f6\uff0c\u8fc7\u7a0b\u7684\u7ed3\u679c\u4e5f\u4f1a\u653e\u5230\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4e2d\uff08\u5f53\u7136\uff0c\u5bf9\u4e8e C \u8bed\u8a00\u8fd9\u79cd\u53ea\u80fd\u6709\u4e00\u4e2a\u8fd4\u56de\u503c\u7684\u8bed\u8a00\uff0c\u53ef\u80fd\u53ea\u4f1a\u7528\u5230 <code>x10</code> \uff09\u3002</li> <li><code>x1</code> \u7528\u6765\u4fdd\u5b58\u8fd4\u56de\u5730\u5740\uff0c\u6240\u4ee5\u4e5f\u53eb <code>ra</code> \u3002\u56e0\u6b64\uff0c\u4f2a\u6307\u4ee4 <code>ret</code> \u5176\u5b9e\u5c31\u662f <code>jalr x0, 0(x1)</code> \u3002</li> <li>\u6808\u6307\u9488\u662f <code>x2</code> \uff0c\u4e5f\u53eb <code>sp</code> \uff1b\u59cb\u7ec8\u6307\u5411 \u6808\u9876\u5143\u7d20\u3002\u6808\u4ece\u9ad8\u5730\u5740\u5411\u4f4e\u5730\u5740\u589e\u957f\u3002<ul> <li><code>addi sp, sp, -24</code> ,  <code>sd x5, 16(sp)</code> ,  <code>sd x6, 8(sp)</code> ,  <code>sd x20, 0(sp)</code> \u53ef\u4ee5\u5b9e\u73b0\u5c06 x5, x6, x20 \u538b\u6808\u3002</li> </ul> </li> <li>\u4e00\u4e9b RISC-V \u7f16\u8bd1\u5668\u4fdd\u7559\u5bc4\u5b58\u5668 <code>x3</code> \u7528\u6765\u6307\u5411\u9759\u6001\u53d8\u91cf\u533a\uff0c\u79f0\u4e3a global pointer  <code>gp</code> \u3002</li> <li>\u4e00\u4e9b RISC-V \u7f16\u8bd1\u5668\u4f7f\u7528 <code>x8</code> \u6307\u5411 activation record \u7684\u7b2c\u4e00\u4e2a dword\uff0c\u65b9\u4fbf\u8bbf\u95ee\u5c40\u90e8\u53d8\u91cf\uff1b\u56e0\u6b64 <code>x8</code> \u4e5f\u79f0\u4e3a frame pointer  <code>fp</code> \u3002\u5728\u8fdb\u5165\u51fd\u6570\u65f6\uff0c\u7528 <code>sp</code> \u5c06 <code>fp</code> \u521d\u59cb\u5316\u3002<ul> <li><code>fp</code> \u7684\u65b9\u4fbf\u6027\u5728\u4e8e\u5728\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u5bf9\u5c40\u90e8\u53d8\u91cf\u7684\u6240\u6709\u5f15\u7528\u76f8\u5bf9\u4e8e <code>fp</code> \u7684\u504f\u79fb\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u4f46\u662f\u5bf9 <code>sp</code> \u4e0d\u4e00\u5b9a\u3002\u5f53\u7136\uff0c\u5982\u679c\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u4ec0\u4e48\u6808\u7684\u53d8\u5316\u6216\u8005\u6839\u672c\u6ca1\u6709\u5c40\u90e8\u53d8\u91cf\uff0c\u90a3\u5c31\u6ca1\u6709\u5fc5\u8981\u7528 <code>fp</code> \u4e86\u3002</li> </ul> </li> </ul> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u5c06\u6240\u6709\u5bc4\u5b58\u5668\u53ca\u5176\u7528\u9014\u603b\u7ed3\u5982\u4e0b\uff1a</p> <p></p> <p>\u5176\u4e2d \"preserved on call\" \u7684\u610f\u601d\u662f\uff0c\u662f\u5426\u4fdd\u8bc1\u8c03\u7528\u524d\u540e\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u4e0d\u53d8\u3002</p> <p></p>"},{"location":"2-x/#26-\u5176\u4ed6\u8bdd\u9898","title":"2.6 \u5176\u4ed6\u8bdd\u9898","text":"<ul> <li>\u68c0\u67e5 index out of bounds\uff1a\u5982\u679c <code>x20 = i, x11 = size</code> \uff0c\u90a3\u4e48 <code>bgeu x20, x11, IndexOutOfBounds</code> \uff0c\u5373  <code>x20 &gt;= x11 || x20 &lt; 0</code> </li> <li>\u5927\u7acb\u5373\u6570</li> <li><code>lui</code> \u5c06 20 \u4f4d\u5e38\u6570\u52a0\u8f7d\u5230\u76ee\u6807\u5bc4\u5b58\u5668\u7684 31 \u5230 12 \u4f4d\uff1b\u7136\u540e\u7528 <code>addi</code> \u586b\u5145\u540e\u9762 12 \u4f4d\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u52a0\u8f7d\u4e00\u4e2a\u5927\u7acb\u5373\u6570\u4e86\u3002</li> <li>\u4f46\u662f\uff0c\u5982\u679c\u540e 12 \u4f4d\u7684\u9996\u4f4d\u662f 1\uff0c\u5728 <code>addi</code> \u7684\u65f6\u5019\u5c31\u4f1a\u56e0\u4e3a <code>sign ext</code> \u989d\u5916\u52a0\u4e0a <code>0xFFFFF000</code> \u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06 <code>lui</code> \u7684 imm \u589e\u52a0 1\uff0c\u8fd9\u6837 <code>lui</code> \u52a0\u8f7d\u540e\u5b9e\u9645\u4e0a\u5c31\u662f\u589e\u52a0\u4e86 <code>0x00001000</code> \uff0c\u548c <code>0xFFFFF000</code> \u76f8\u52a0\u540e\u5c31\u53ef\u4ee5\u62b5\u6d88\u5f71\u54cd\u4e86\u3002</li> <li>ASCII\uff0c\u662f 8 \u4f4d\u7684\uff0c\u53ef\u4ee5\u7528 <code>lbu</code> </li> <li>Unicode\uff0c\u662f 16 \u4f4d\u7684\uff0c\u53ef\u4ee5\u7528 <code>lhu</code> </li> <li>\u5c3e\u9012\u5f52 tail call / tail recursion\uff0c\u53ef\u4ee5\u8f6c\u6210\u5faa\u73af\u3002</li> </ul>"},{"location":"3-x/","title":"3 \u7b97\u672f | Arithmetic","text":"<p> \u7ea6 2991 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p>"},{"location":"3-x/#31-\u4e00\u4e2a\u57fa\u672c\u7684-alu","title":"3.1 \u4e00\u4e2a\u57fa\u672c\u7684 ALU","text":"<p>\u4e16\u754c\u4e0a\u4e0d\u5b58\u5728\u51cf\u6cd5\u3002\u4f17\u6240\u5468\u77e5\uff0c\u51cf\u6cd5\u5c31\u662f\u52a0\u4e0a\u76f8\u53cd\u6570\u3002\u6240\u4ee5\u8fd9\u4e2a\u4e16\u754c\u4e0a\u4e0d\u5b58\u5728\u51cf\u6cd5\u3002</p> <p>Overflow\u3002\u786c\u4ef6\u89c4\u6a21\u662f\u6709\u9650\u7684\uff0c\u56e0\u6b64\u8fd0\u7b97\u7ed3\u679c\u8d85\u8fc7\u8fd9\u4e2a\u9650\u5236\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u6ea2\u51fa\u3002\u5bf9\u4e8e\u6709\u7b26\u53f7\u52a0\u6cd5\uff0c\u5f53\u6b63\u6570\u548c\u6b63\u6570\u76f8\u52a0\u5f97\u5230\u8d1f\u6570\uff0c\u6216\u8005\u8d1f\u6570\u548c\u8d1f\u6570\u76f8\u52a0\u5f97\u5230\u6b63\u6570\u65f6\uff0c\u5c31\u53ef\u4ee5\u5224\u5b9a\u6ea2\u51fa\u3002\u5bf9\u4e8e\u65e0\u7b26\u53f7\u52a0\u6cd5\uff0c\u5982\u679c\u7ed3\u679c\u5c0f\u4e8e\u4e8c\u8005\u4e2d\u4efb\u610f\u4e00\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u5224\u5b9a\u6ea2\u51fa\u3002</p> <p>ALU, Arithmetic Logic Unit\uff0c\u7b97\u672f\u903b\u8f91\u5355\u5143\uff0c\u6267\u884c\u4e00\u4e9b\u7b97\u672f\u8fd0\u7b97\u6216\u8005\u903b\u8f91\u8fd0\u7b97\u3002</p>"},{"location":"3-x/#311-1-bit-alu","title":"3.1.1 1-bit ALU","text":"<p>\uff08\u4e0b\u9762\u8fd9\u90e8\u5206\u5185\u5bb9\u5728\u8bfe\u672c\u9644\u5f55 A.5 \u5f00\u59cb\u7684\u5730\u65b9\uff09</p> <p>\u5728\u6570\u5b57\u903b\u8f91\u8bbe\u8ba1\u8fd9\u95e8\u8bfe\u7a0b\u4e2d\uff0c\u6211\u4eec\u5b66\u8fc7 AND, OR, XOR \u8fd9\u4e9b gates\uff0c\u4ee5\u53ca inverter \u548c mux \u8fd9\u4e9b\u4e1c\u897f\uff0c\u6211\u4eec\u5c1d\u8bd5\u7528\u8fd9\u4e9b\u4e1c\u897f\u6512\u4e00\u4e2a ALU \u51fa\u6765\u3002\u5728\u8fd9\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5e0c\u671b ALU \u5177\u6709\u52a0\u6cd5\u3001\u51cf\u6cd5\u3001\u4e0e\u8fd0\u7b97\u3001\u6216\u8fd0\u7b97\u548c\u6bd4\u8f83\u7684\u80fd\u529b\u3002</p> <p>\u6211\u4eec\u5148\u8003\u8651 1 bit ALU \u7684\u6784\u9020\u3002\u6211\u4eec\u5b66\u4e60\u8fc7 1 bit Full Adder \u7684\u6784\u9020\uff1a  </p> <p>\u4e0a\u5de6\u56fe\u662f\u5168\u52a0\u5668\u7684\u5177\u4f53\u6784\u9020\uff0c\u53f3\u56fe\u662f\u6211\u4eec\u5c06\u5176\u8fdb\u884c\u5c01\u88c5\u540e\u7684\u8868\u793a\u65b9\u5f0f\u3002</p> <p>\u6211\u4eec\u7ed3\u5408\u4e00\u4e2a mux\uff0c\u5c31\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u652f\u6301\u4e0e\u3001\u6216\u4ee5\u53ca\u52a0\u6cd5\u8fd0\u7b97\u7684 1 bit ALU\uff1a </p> <p>\u5176\u4e2d <code>Operation</code> \u662f\u7528\u6765\u6307\u660e mux \u91c7\u53d6\u54ea\u4e2a\u7ed3\u679c\u7684\u4fe1\u53f7\uff0c\u503c\u4e3a 00 01 10 \u5206\u522b\u5bf9\u5e94\u4e0e\u3001\u6216\u3001\u52a0\u6cd5\u8fd0\u7b97\u3002</p>"},{"location":"3-x/#312-\u52a0\u4e0a\u51cf\u6cd5\u548c-nor","title":"3.1.2 \u52a0\u4e0a\u51cf\u6cd5\u548c NOR\uff01","text":"<p>\u51cf\u6cd5\u8fd0\u7b97\u600e\u4e48\u529e\u5462\uff1f\u4f17\u6240\u5468\u77e5\uff0c\u7531\u4e8e\u8865\u7801\u6709 \\(x + \\bar x = 111\\dots111_2 = -1\\)\uff0c\u56e0\u6b64 \\(-x = \\bar x + 1\\)\uff0c\u6240\u4ee5 \\(a - b = a + (-b) = a + \\bar b + 1\\)\u3002\u636e\u6b64\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u8fd9\u6837\u7684\u7ed3\u6784\uff1a</p> <p></p> <p>\u5176\u4e2d <code>Binvert</code> \u7528\u6765\u6307\u660e\u662f\u5426\u9700\u8981\u5c06\u7ed3\u679c\u53d6\u53cd\uff1b\u5728\u8ba1\u7b97\u51cf\u6cd5\u65f6\uff0c\u6211\u4eec\u5c06 <code>Binvert</code> \u8bbe\u4e3a <code>1</code> \uff0c\u7136\u540e\u5c06 <code>CarryIn</code> \u4e5f\u8bbe\u4e3a <code>1</code> \uff0c <code>Operation</code> \u8bbe\u4e3a <code>2</code> \uff0c\u8fd9\u6837\u6211\u4eec\u7684\u7ed3\u679c\u5c31\u662f \\(a + \\bar b + 1\\)\u3002</p> <p><code>NOR</code> \u8fd0\u7b97\uff1a <code>a NOR b = NOT(a OR b) = (NOT a) AND (NOT b)</code> \uff0c\u56e0\u6b64 <code>NOR</code> \u8fd0\u7b97\u53ef\u4ee5\u8fd9\u6837\u5b9e\u73b0\uff1a</p> <p> </p> <p>\u4e0a\u53f3\u56fe\u662f\u6211\u4eec\u76ee\u524d\u7684 1 bit ALU \u7684\u62bd\u8c61\u7ed3\u6784\u3002</p>"},{"location":"3-x/#313-\u4e32\u8054\u5f97\u5230-64-bit-alu","title":"3.1.3 \u4e32\u8054\u5f97\u5230 64-bit ALU\uff01","text":"<p>\u6709\u4e86 1 bit \u7684 ALU\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6784\u9020\u51fa RISC-V \u6240\u9700\u7684 64 bits \u7684 ALU \u4e86\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5bf9\u4e8e 64 \u4f4d\u7684\u52a0\u6cd5\u3001\u51cf\u6cd5\u3001AND, OR, NOR \u8fd0\u7b97\uff0c\u8fd9\u6837\u7684 64 \u4f4d ALU \u90fd\u53ef\u4ee5\u5b8c\u6210\u3002</p> <p>\u540c\u65f6\u4e5f\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u8fd9\u91cc\u9762\u9664\u4e86\u6211\u4eec\u719f\u6089\u7684\u5185\u5bb9\u5916\uff0c\u8fd8\u591a\u4e86 <code>Less</code> ,  <code>Set</code> \u548c <code>Overflow</code> \u8fd9\u4e9b\u4f4d\u3002\u5b83\u4eec\u662f\u7528\u6765\u5e72\u4ec0\u4e48\u7684\u5462\uff1f</p> <p>\u9996\u5148 <code>Overflow</code> \u662f\u5bb9\u6613\u7406\u89e3\u7684\uff0c\u5b83\u7528\u6765\u8868\u793a\u52a0\u6cd5\u6216\u51cf\u6cd5\u6709\u6ca1\u6709\u51fa\u73b0\u6ea2\u51fa\u7684\u73b0\u8c61\uff1b\u663e\u7136\u8fd9\u4e2a\u5224\u65ad\u53ea\u9700\u8981\u5728 ALU63\uff0c\u5373 Most Significant Bit \u624d\u9700\u8981\u8fdb\u884c\u3002\u5bb9\u6613\u8bc1\u660e\uff0c\u5982\u679c \\(C_{in} \\oplus C_{out} = 1\\)\uff0c\u90a3\u4e48\u5b58\u5728\u6ea2\u51fa\uff1b\u56e0\u6b64 ALU63 \u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u7684 XOR \u95e8\u5373\u53ef\u5b8c\u6210\u8fd9\u4e00\u5224\u65ad\u3002</p> <p><code>Less</code> \u548c <code>Set</code> \u5171\u540c\u4f7f\u7528\uff0c\u662f\u4e3a\u4e86\u5b9e\u73b0 <code>slt rd, rs1, rs2</code> \u8fd9\u4e2a\u64cd\u4f5c\u7684\u3002\u8fd9\u4e2a\u64cd\u4f5c\u7684\u542b\u4e49\u662f\uff0c\u5982\u679c <code>rs1 &lt; rs2</code> \uff0c\u90a3\u4e48\u5c06 <code>rd</code> \u7f6e\u4e3a <code>1</code> \uff0c\u5426\u5219\u7f6e\u4e3a <code>0</code> \u3002\u5982\u4f55\u8fdb\u884c\u8fd9\u4e00\u5224\u65ad\u5462\uff1f\u5f88\u7b80\u5355\uff0c\u5982\u679c <code>rs1 - rs2</code> \u7684\u7ed3\u679c\u4e3a\u8d1f\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c <code>rs1 - rs2</code> \u7ed3\u679c\u7684\u6700\u9ad8\u4f4d\u662f <code>1</code> \uff0c\u90a3\u4e48\u5c31\u8bf4\u660e <code>rs1 &lt; rs2</code> \u3002\u6240\u4ee5\u7b49\u4ef7\u5730\uff0c\u5bf9\u4e8e <code>slt</code> \u8fd9\u4e2a\u64cd\u4f5c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06 ALU63 \u4e2d\u52a0\u6cd5\u5668\u7684\u7ed3\u679c\u8d4b\u503c\u7ed9 <code>Result0</code> \uff0c\u5373\u8fd0\u7b97\u7ed3\u679c\u7684 Least Significant Bit\uff0c\u800c\u5c06\u5176\u4ed6\u4f4d\u7684\u7ed3\u679c <code>Result1</code> ~ <code>Result63</code> \u90fd\u8bbe\u6210 0\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210 <code>slt</code> \u64cd\u4f5c\u4e86\u3002</p> <p>\u6240\u4ee5\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u56fe\u4e2d\uff0c\u9664\u4e86 ALU0 \u7684 <code>Less</code> \u6765\u81ea ALU63 \u7684 <code>Set</code> \u5916\uff0c\u5176\u4ed6 ALU \u7684 <code>Less</code> \u90fd\u662f <code>0</code> \u3002</p> <p>\u7ed3\u5408\u4e0a\u8ff0\u8ba8\u8bba\uff0c\u4e0a\u56fe\u4e2d ALU0 ~ ALU62 \u7684\u7ed3\u6784\u5982\u4e0b\u7b2c\u4e00\u5f20\u56fe\u6240\u793a\uff0cALU63 \u7684\u7ed3\u6784\u5982\u4e0b\u7b2c\u4e8c\u5f20\u56fe\u6240\u793a\uff1a</p> <p></p> <p></p> <p>\uff08\u6ce8\uff1a\u7b2c\u4e8c\u5f20\u56fe\u4e2d\u7684 Overflow Detection \u88ab\u590d\u6742\u5316\u4e86\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u901a\u8fc7 <code>CarryIn</code> \u548c <code>CarryOut</code> \u7684\u5f02\u6216\u5b8c\u6210\u7684\u3002\uff09</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c <code>Operation</code> \u589e\u52a0\u4e86 <code>3</code> \u7684\u53d6\u503c\uff0c\u8fd9\u4e2a\u53d6\u503c\u8868\u793a\u8fdb\u884c <code>slt</code> \u64cd\u4f5c\u3002</p>"},{"location":"3-x/#314-\u4e00\u70b9\u4f18\u5316","title":"3.1.4 \u4e00\u70b9\u4f18\u5316\uff01","text":"<p>\u4e4b\u524d\u6211\u4eec\u4e5f\u8ba8\u8bba\u8fc7\uff0c\u5982\u679c\u505a\u51cf\u6cd5\u6216\u8005 <code>slt</code> \u7684\u8bdd\uff0c\u9700\u8981\u5c06 <code>Binvert</code> \u548c ALU0 \u7684 <code>CarryIn</code> \u8bbe\u6210 <code>1</code> \uff0c\u5982\u679c\u662f\u52a0\u6cd5\u7684\u8bdd\u8fd9\u4e24\u4e2a\u4fe1\u53f7\u90fd\u662f <code>0</code> \uff1b\u5176\u4ed6\u8fd0\u7b97\u7528\u4e0d\u5230\u8fd9\u4e24\u4e2a\u4fe1\u53f7\u3002\u56e0\u6b64\u8fd9\u4e24\u4e2a\u4fe1\u53f7\u59cb\u7ec8\u53d6\u503c\u76f8\u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e24\u4e2a\u4fe1\u53f7\u5408\u5e76\u4e3a\u4e00\u4e2a\uff0c\u79f0\u4e4b\u4e3a <code>Bnegate</code> \u3002</p> <p>\u53e6\u5916\uff0c\u6211\u4eec\u4e5f\u6709 <code>beq</code> \uff0c <code>bne</code> \u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u7ed3\u5408 Common case fast \u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u6211\u4eec\u5c06\u5224\u65ad\u7ed3\u679c\u662f\u5426\u4e3a 0 \u7684\u529f\u80fd\u4e5f\u76f4\u63a5\u52a0\u5230 ALU \u91cc\u3002</p> <p>\u7ed3\u5408\u4e0a\u8ff0\u4e24\u4e2a\u601d\u8def\uff0c\u6211\u4eec\u5f62\u6210\u4e86\u6700\u7ec8\u7684 64-bit ALU\uff01</p> <p></p> <p>\u5bf9\u4e8e\u8fd9\u6837\u7684\u4e00\u4e2a ALU\uff0c\u6211\u4eec\u9700\u8981 4 bits \u7684 control lines\uff0c\u5206\u522b\u662f <code>Ainvert</code> ,  <code>Bnegate</code> \u548c <code>Operation</code> (2 bits)\u3002ALU \u7684\u7b26\u53f7\u548c control lines \u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <p> </p>"},{"location":"3-x/#315-\u66f4\u5feb\u7684\u52a0\u6cd5","title":"3.1.5 \u66f4\u5feb\u7684\u52a0\u6cd5","text":"<p>\u4e0a\u9762\u7684 64 \u4f4d\u52a0\u6cd5\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u901a\u8fc7 1 \u4f4d\u52a0\u6cd5\u5668\u4e32\u8054\u5b9e\u73b0\u7684\uff0c\u8fd9\u79cd\u65b9\u5f0f\u52bf\u5fc5\u9700\u8981\u7b49\u5f85\u524d\u4e00\u4e2a\u52a0\u6cd5\u5668\u7b97\u51fa\u7ed3\u679c\u540e\u624d\u80fd\u7b97\u540e\u4e00\u4e2a\u7684\u3002\u8fd9\u79cd\u591a\u4f4d\u52a0\u6cd5\u5668\u7684\u5b9e\u73b0\u79f0\u4e3a\u884c\u6ce2\u52a0\u6cd5\u5668 Ripple Carry Adder, RCA\u3002\u663e\u7136\uff0c\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u6bd4\u8f83\u6162\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u4f55\u52a0\u901f\u5462\uff1f</p>"},{"location":"3-x/#3151-carry-lookahead-adder-cla","title":"3.1.5.1 Carry Lookahead Adder, CLA","text":"<p>\u8bfe\u672c\u6307\u51fa\uff0cRCA \u7f13\u6162\u7684\u91cd\u8981\u539f\u56e0\u662f\u540e\u4e00\u4e2a adder \u9700\u8981\u7b49\u524d\u4e00\u4e2a adder \u7684 carry \u7ed3\u679c\uff1b\u4f46\u6211\u4eec\u4e0d\u59a8\u8ba8\u8bba\u51fa\u73b0 carry \u7684\u53ef\u80fd\u3002\u7b2c\u4e00\u79cd\u53ef\u80fd\u662f\uff0c\u5982\u679c \\(a\\) \u548c \\(b\\) \u90fd\u662f 1\uff0c\u90a3\u4e48\u4e00\u5b9a\u4f1a \u751f\u6210 \u4e00\u4e2a carry\uff1b\u53e6\u4e00\u79cd\u53ef\u80fd\u662f\uff0c\u5982\u679c \\(a\\) \u548c \\(b\\) \u4e2d\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u662f 1\uff0c\u90a3\u4e48\u5982\u679c\u4f20\u5165\u7684 carry \u662f 1\uff0c\u5219\u8fd9\u91cc\u4e5f\u4f1a carry\uff0c\u5373 carry \u88ab \u4f20\u64ad \u4e86\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\\(c_{out} = a \\cdot b + (a + b)\\cdot c_{in}\\)\u3002\u6211\u4eec\u8bb0 generate \\(g = a\\cdot b\\)\uff0cpropagate \\(p = a + b\\)\uff0c\u5219\u6709 \\(c_{out} = g + p \\cdot c_{in}\\)\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u6784\u9020\u4e00\u4e2a\u5168\u52a0\u5668\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u63a8\u5bfc\u51fa\u5982\u4e0b\u5173\u7cfb\uff1a</p> <p></p> <p>\u5229\u7528\u8fd9\u4e2a\u5173\u7cfb\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u8fd9\u6837\u4e00\u4e2a\u56db\u4f4d\u52a0\u6cd5\u5668\uff1a</p> <p></p> <p>\u4e0a\u9762\u7684 PFA, Partial Fully Adder\uff0c\u5c31\u662f\u524d\u9762\u6211\u4eec\u6784\u9020\u7684\u65b0\u5168\u52a0\u5668\u7684\u4e00\u90e8\u5206\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u52a0\u901f\u52a0\u6cd5\u7684\u8fd0\u7b97\uff1b\u4f46\u662f\u6ce8\u610f\u5230\u8d8a\u5230\u9ad8\u4f4d\uff0c\u95e8\u7684 fan-in \u5c31\u8d8a\u5927\uff0c\u4f46\u662f\u8fd9\u4e0d\u662f\u53ef\u4ee5\u4e00\u76f4\u589e\u52a0\u7684\u3002\u6240\u4ee5\u5bf9\u4e8e\u66f4\u591a\u4f4d\u6570\u7684\u52a0\u6cd5\u5668\uff0c\u6211\u4eec\u5c06\u4e0a\u9762\u8fd9\u6837\u6784\u6210\u7684 4-bit CLA \u518d\u901a\u8fc7\u7c7b\u4f3c\u7684\u65b9\u5f0f\u4e32\u8d77\u6765\uff01</p> <p></p>"},{"location":"3-x/#3152-carry-skip-adder-\u9a6c\u5fb7\u5148\u751f\u6ca1\u8bb2","title":"3.1.5.2 Carry Skip Adder (\u9a6c\u5fb7\u5148\u751f\u6ca1\u8bb2)","text":""},{"location":"3-x/#3153-carry-select-adder-csa","title":"3.1.5.3 Carry Select Adder, CSA","text":"<p>\u8fd9\u4e2a\u601d\u8def\u5176\u5b9e\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u628a\u8f93\u5165 carry \u4e3a 0 \u6216\u8005 1 \u7684\u60c5\u51b5\u90fd\u7b97\u4e00\u904d\uff0c\u7136\u540e\u6839\u636e\u5b9e\u9645\u7684\u60c5\u51b5\u4ece\u4e2d\u9009\u51fa\u6b63\u786e\u7684\u90a3\u79cd\u5c31\u597d\u4e86\uff1a</p> <p></p> <p></p>"},{"location":"3-x/#32-\u4e58\u6cd5-\u6682\u65f6\u4e0d\u60f3\u5b66\u4e86\u542c\u8bf4\u8003\u7684\u4e0d\u591a","title":"3.2 \u4e58\u6cd5 \u6682\u65f6\u4e0d\u60f3\u5b66\u4e86\uff0c\u542c\u8bf4\u8003\u7684\u4e0d\u591a","text":"<p>\u4e0b\u9762\u8fd9\u6837\u7684\u786c\u4ef6\u7ed3\u6784\u53ef\u4ee5\u5b9e\u73b0\u65e0\u7b26\u53f7\u4e58\u6cd5\uff1a</p> <p></p>"},{"location":"3-x/#33-\u9664\u6cd5-\u6682\u65f6\u4e0d\u60f3\u5b66\u4e86\u542c\u8bf4\u8003\u7684\u4e0d\u591a","title":"3.3 \u9664\u6cd5 \u6682\u65f6\u4e0d\u60f3\u5b66\u4e86\uff0c\u542c\u8bf4\u8003\u7684\u4e0d\u591a","text":""},{"location":"3-x/#34-\u6d6e\u70b9\u8fd0\u7b97","title":"3.4 \u6d6e\u70b9\u8fd0\u7b97","text":""},{"location":"3-x/#341-ieee-754-\u6d6e\u70b9\u8868\u793a","title":"3.4.1 IEEE 754 \u6d6e\u70b9\u8868\u793a","text":"<p>\u6211\u4eec\u5c06\u5c0f\u6570\u70b9\u5de6\u8fb9\u53ea\u6709 1 \u4f4d\u6570\u5b57\u7684\u8868\u793a\u6570\u7684\u65b9\u6cd5\u79f0\u4e3a \u79d1\u5b66\u8bb0\u6570\u6cd5, scientific notation\uff0c\u800c\u5982\u679c\u5c0f\u6570\u70b9\u5de6\u8fb9\u7684\u6570\u5b57\u4e0d\u662f 0\uff0c\u6211\u4eec\u79f0\u8fd9\u4e2a\u6570\u7684\u8868\u793a\u662f\u4e00\u4e2a \u89c4\u683c\u5316\u6570, normalized number\u3002\u79d1\u5b66\u8bb0\u6570\u6cd5\u80fd\u7528\u6765\u8868\u793a\u5341\u8fdb\u5236\u6570\uff0c\u5f53\u7136\u4e5f\u80fd\u7528\u6765\u8868\u793a\u4e8c\u8fdb\u5236\u6570\u3002</p> <p>IEEE 754 \u89c4\u5b9a\u4e86\u4e00\u79cd\u6d6e\u70b9\u6570\u6807\u51c6\uff1a\u6211\u4eec\u5c06\u6d6e\u70b9\u6570\u8868\u793a\u4e3a \\((-1)^S \\times F \\times 2^E\\) \u7684\u5f62\u5f0f\uff0c\u8fd9\u91cc\u7684 \\(F \\times 2^E\\) \u662f\u4e00\u4e2a\u89c4\u683c\u5316\u6570\uff0c\u800c \\((-1)^S\\) \u7528\u6765\u8868\u793a\u7b26\u53f7\u4f4d\uff1a\\(S\\) \u4e3a 0 \u8bf4\u660e\u8be5\u6d6e\u70b9\u6570\u4e3a\u6b63\u6570\uff0c\u4e3a 1 \u5219\u4e3a\u8d1f\u6570\uff1b\\(F\\) \u548c \\(E\\) \u4e5f\u7528\u82e5\u5e72 bits \u8868\u793a\uff0c\u5206\u522b\u8868\u793a\u5c3e\u6570\u548c\u6307\u6570\uff0c\u6211\u4eec\u7a0d\u540e\u8ba8\u8bba\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u5c06\u5176\u8868\u793a\u4e3a \\(1.\\text{xxxxx}_2\\times 2^{\\text{yyyy}}\\) \u7684\u5f62\u5f0f\uff08\u4e3a\u4ec0\u4e48\u5c0f\u6570\u70b9\u5de6\u8fb9\u662f 1 \u5462\uff1f\u56e0\u4e3a\u4e8c\u8fdb\u5236\u53ea\u6709 0 \u548c 1\uff0c\u800c\u89c4\u683c\u5316\u8981\u6c42\u5c0f\u6570\u70b9\u5de6\u8fb9\u4e0d\u80fd\u4e3a 0\uff09\u3002\u6211\u4eec\u901a\u8fc7\u79d1\u5b66\u8bb0\u6570\u6cd5\u8c03\u6574\u4e86\u5c0f\u6570\u70b9\u7684\u4f4d\u7f6e\u4f7f\u5176\u6ee1\u8db3\u89c4\u683c\u5316\u7684\u8981\u6c42\uff0c\u56e0\u6b64\u6211\u4eec\u79f0\u8fd9\u79cd\u6570\u7684\u8868\u793a\u65b9\u6cd5\u4e3a \u6d6e\u70b9, floating point\u3002</p> <p>\u5c0f\u6570\u70b9\u7684\u82f1\u6587\u662f decimal point\uff0c\u4f46\u662f\u6211\u4eec\u8fd9\u79cd\u8868\u793a\u65b9\u6cd5\u4e0d\u518d\u662f decimal \u7684\u4e86\uff0c\u56e0\u6b64\u6211\u4eec\u8d77\u4e2a\u65b0\u540d\u5b57\uff1a\u4e8c\u8fdb\u5236\u5c0f\u6570\u70b9, binary point\u3002</p> <p>IEEE 754 \u89c4\u5b9a\u4e86\u4e24\u79cd\u7cbe\u5ea6\u7684\u6d6e\u70b9\u6570\u683c\u5f0f\uff0c\u5206\u522b\u662f single precision \u548c double precision\uff08\u5206\u522b\u5bf9\u5e94 C \u8bed\u8a00\u4e2d\u7684 <code>float</code> \u548c <code>double</code> \uff09\uff0cRISC-V \u8fd9\u4e24\u79cd\u90fd\u652f\u6301\uff1a</p> <p></p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cfraction \u7684\u4f4d\u6570\u8d8a\u591a\uff0c\u6d6e\u70b9\u6570\u7684\u7cbe\u5ea6\u5c31\u8d8a\u9ad8\uff1b\u800c exponent \u7684\u4f4d\u6570\u8d8a\u591a\uff0c\u6d6e\u70b9\u6570\u80fd\u4fdd\u5b58\u7684\u8303\u56f4\u5c31\u8d8a\u5927\u3002</p> <p>\u90a3\u4e48\u5bf9\u4e8e \\((-1)^S \\times F \\times 2^E\\)\uff0c\\(S\\) \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u65b9\u6cd5\u662f\u663e\u7136\u7684\uff0c\u4ec5\u9700\u8981\u4e00\u4e2a bit \u5c31\u597d\u4e86\u3002\u90a3\u4e48 \\(F\\) \u548c \\(E\\) \u600e\u4e48\u8868\u793a\u5462\uff1f\u5982\u6211\u4eec\u4e4b\u524d\u6240\u8bf4\uff0c\\(F\\) \u5c31\u662f \\(1.\\text{xxxxx}_2\\) \u7684\u5f62\u5f0f\uff0c\u8fd9\u4e2a 1 \u662f\u56fa\u5b9a\u7684\uff0c\u56e0\u6b64 \\(F\\) \u53ea\u9700\u8981\u4fdd\u5b58 \\(\\text{xxxxx}\\) \u7684\u90e8\u5206\u5c31\u53ef\u4ee5\u4e86\uff01\u90a3\u4e48 \\(E\\) \u600e\u4e48\u529e\u5462\uff1f\u6ce8\u610f\u5230\u8fd9\u4e2a\u6307\u6570\u53ef\u80fd\u662f\u6b63\u6574\u6570\u3001\u8d1f\u6574\u6570\u6216 0\uff0c\u56e0\u6b64\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u504f\u79fb\uff0c\u5bf9\u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570\u504f\u79fb 127\uff0c\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\u504f\u79fb 1023\uff08\u521a\u597d\u662f\u8868\u793a\u8303\u56f4\u7684\u4e00\u534a\uff01\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u4fdd\u5b58\u7684  <code>exponent</code>  \u5176\u5b9e\u662f \\(E + bias\\) \u7684\u4e8c\u8fdb\u5236\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u8fd9\u6837\u7684\u4e00\u4e2a\u8868\u793a\uff0c\u5176\u503c\u662f\uff1a</p> \\[(-1)^S\\cdot (1 + \\text{fraction}) \\cdot 2 ^ {\\text{exponent} - \\text{bias}}\\] <p>\u8bfe\u672c\u7ed9\u51fa\u4e86\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <p></p> <p>\u806a\u660e\u7684\u5c0f\u670b\u53cb\u53ef\u80fd\u4f1a\u95ee\uff0c0 \u5e94\u8be5\u600e\u4e48\u4fdd\u5b58\u5462\uff1f\u6bd5\u7adf 0 \u6ca1\u6709\u524d\u5bfc 1\u3002\u5bf9\u4e8e\u8fd9\u6837\u7684\u7279\u6b8a\u60c5\u5f62\uff0cIEEE 754 \u6709\u7279\u522b\u89c4\u5b9a\uff0c\u7528\u7279\u6b8a\u7684\u503c\u4fdd\u5b58\u5b83\u4eec\uff1a</p> <p></p> <p>\u5728\u4e0a\u8868\u4e2d\uff1a</p> <ul> <li>\u7b2c 1 \u6761\u8868\u793a 0\uff1b</li> <li>\u7b2c 2 \u6761\u8868\u793a\u975e\u89c4\u683c\u5316\u6570\uff0c\u8fd9\u79cd\u6570\u4e3b\u8981\u662f\u4e3a\u4e86\u7528\u6765\u8868\u793a\u4e00\u4e9b\u5f88\u5c0f\u7684\u6570\uff0c\u5b83\u7684\u53d6\u503c\u4e3a \\((-1)^S\\cdot (\\mathbf{0} + \\text{fraction}) \\cdot 2 ^ {- \\text{bias}}\\)\uff1b\u4f46\u662f\u5e76\u975e\u6240\u6709\u673a\u5668\u90fd\u652f\u6301\u8fd9\u79cd\u8868\u793a\uff0c\u6709\u7684\u673a\u5668\u4f1a\u76f4\u63a5\u629b\u51fa\u4e00\u4e2a exception\u3002\u6211\u4eec\u4e0d\u8003\u8651\u975e\u89c4\u683c\u6570\u7684\u5b58\u5728\uff1b</li> <li>\u7b2c 3 \u6761\u8868\u793a\u6b63\u5e38\u7684\u6d6e\u70b9\u6570\uff1b</li> <li>\u7b2c 4 \u6761\u8868\u793a\u65e0\u7a77\u5927\u6216\u8005\u65e0\u7a77\u5c0f\uff0c\u51fa\u73b0\u5728 exponent overflow \u6216\u8005\u6d6e\u70b9\u6570\u8fd0\u7b97\u4e2d\u975e 0 \u6570\u9664\u4ee5 0 \u7684\u60c5\u51b5\uff1b</li> <li>\u7b2c 5 \u6761\u8868\u793a\u975e\u6570\uff0c\u51fa\u73b0\u5728 0/0, inf / inf, inf - inf, inf * 0 \u7684\u60c5\u51b5</li> </ul> <p>\uff08\u5982\u679c\u6570\u5b57\u8fc7\u5927\u4e0d\u80fd\u8868\u793a\uff0c\u5373 overflow\uff0c\u5219\u7ed3\u679c\u7f6e\u4e3a inf\uff1b\u5982\u679c\u6570\u5b57\u8fc7\u5c0f\u4e0d\u80fd\u8868\u793a\uff0c\u5373 underflow\uff0c\u5219\u7ed3\u679c\u7f6e\u4e3a 0\u3002\uff09</p> <p>\u8fd9\u4e24\u79cd\u8868\u793a\u6cd5\u7684\u8303\u56f4\u548c\u7cbe\u5ea6\u5206\u522b\u662f\u591a\u5c11\u5462\uff1f</p> <ul> <li> <p>\u8303\u56f4</p> <ul> <li>\u80fd\u8868\u793a\u503c\u7684 \u7edd\u5bf9\u503c \u7684\u8303\u56f4\u662f \\(1.0_2 \\times 2^{1-\\text{bias}} \\sim 1.11\\dots 11_2 \\times 2^{11\\dots 11_2-1-\\text{bias}}\\)\uff0c\u5373 \\(1\\times 2^{1 - \\text{bias}}\\sim(2 - 2^\\text{-Fra#})\\times 2^{(2^\\text{Exp#} - 1) - 1 - \\text{bias}}\\)\uff0c\u5176\u4e2d <code>Fra#</code> \u548c <code>Exp#</code> \u5206\u522b\u8868\u793a fraction \u548c exponent \u7684\u4f4d\u6570\uff1b</li> <li>\u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff1a\\(\\pm 1\\times 2^{-126}\\sim \\pm(2 - 2^{-23}) \\times 2^{127}\\)</li> <li>\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff1a\\(\\pm 1\\times 2^{-1022}\\sim \\pm(2 - 2^{-52}) \\times 2^{1023}\\)</li> </ul> </li> <li> <p>\u7cbe\u5ea6</p> <ul> <li>\\(2^ \\text{-Fra#}\\)</li> <li>\u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff1a\\(2^{-23}\\)</li> <li>\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff1a\\(2^{-52}\\)</li> </ul> </li> </ul> <p>18~19 Final</p> <p></p> \u7b54\u6848 <p>+inf, 0xBF800000</p> <p>\u53ef\u4ee5\u8bd5\u4e00\u4e0b -32.6\uff0c\u7ed3\u679c\u53ef\u4ee5\u81ea\u5df1\u5728 IEEE-754 Floating Point Converter \u91cc\u9762\u627e~</p>"},{"location":"3-x/#342-\u6d6e\u70b9\u52a0\u6cd5","title":"3.4.2 \u6d6e\u70b9\u52a0\u6cd5","text":"<p>\u4ee5 \\(1.000_2\\times2^{-1}-1.110_2\\times2^{-2}\\) \u4e3a\u4f8b\uff0c \u6d6e\u70b9\u6570\u7684\u52a0\u51cf\u6cd5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u6b65\uff1a</p> <ol> <li>\u6307\u6570\u5bf9\u9f50\uff0c\u5c06\u5c0f\u6307\u6570\u5bf9\u9f50\u5230\u5927\u6307\u6570\uff1a\\(-1.110_2\\times2^{-2} = -0.111\\times2^{-1}\\)</li> <li>Fraction \u90e8\u5206\u76f8\u52a0\u51cf\uff1a\\(1.000-0.111=0.001\\)</li> <li>\u5c06\u7ed3\u679c\u89c4\u683c\u5316\uff1a\\(0.001\\times2^{-1}=1.000\\times2^{-4}\\)\uff1b\u540c\u65f6\u9700\u8981\u68c0\u67e5\u662f\u5426\u51fa\u73b0 overflow \u6216\u8005 underflow\uff0c\u5982\u679c\u51fa\u73b0\u5219\u89e6\u53d1 Exception</li> <li>\u5c06 Fraction \u90e8\u5206\u820d\u5165\u5230\u6b63\u786e\u4f4d\u6570\uff1b\u820d\u5165\u7ed3\u679c\u53ef\u80fd\u8fd8\u9700\u8981\u89c4\u683c\u5316\uff0c\u6b64\u65f6\u56de\u5230\u6b65\u9aa4 3 \u7ee7\u7eed\u8fd0\u884c</li> </ol> <p></p> <p></p>"},{"location":"3-x/#343-\u6d6e\u70b9\u4e58\u6cd5","title":"3.4.3 \u6d6e\u70b9\u4e58\u6cd5","text":"<p>\u5206\u522b\u5904\u7406\u7b26\u53f7\u4f4d\u3001exponent \u548c fraction\uff1a</p> <ul> <li>Exponent \u76f8\u52a0\u5e76 \u51cf\u53bb bias\uff0c\u56e0\u4e3a bias \u52a0\u4e86 2 \u6b21</li> <li>Fraction \u90e8\u5206\u76f8\u4e58\uff0c\u5e76\u5c06\u5176\u89c4\u683c\u5316\uff1b\u6b64\u65f6\u540c\u6837\u8981\u8003\u8651 overflow \u548c underflow\uff1b\u7136\u540e\u820d\u5165\uff0c\u5982\u679c\u8fd8\u9700\u8981\u89c4\u683c\u5316\u5219\u91cd\u590d\u6267\u884c</li> <li>\u6839\u636e\u4e24\u4e2a\u64cd\u4f5c\u6570\u7684\u7b26\u53f7\u51b3\u5b9a\u7ed3\u679c\u7684\u7b26\u53f7</li> </ul> <p></p>"},{"location":"3-x/#344-\u7cbe\u786e\u7b97\u672f","title":"3.4.4 \u7cbe\u786e\u7b97\u672f","text":"<p>IEEE 754 \u89c4\u5b9a\u4e86\u4e00\u4e9b\u989d\u5916\u7684\u820d\u5165\u63a7\u5236\uff0c\u7528\u6765\u4fdd\u8bc1\u820d\u5165\u7684\u7cbe\u786e\u6027\u3002</p> <p>Round modes</p> <p></p> <p>Round to nearest even \u53ea\u5bf9 0.5 \u6709\u6548\uff0c\u522b\u7684\u90fd\u548c\u56db\u820d\u4e94\u5165\u4e00\u6837</p> <p>\u4e00\u822c\u7684\u6d6e\u70b9\u6570\u540e\u9762\u8fd8\u4f1a\u6709 2 bits\uff0c\u5206\u522b\u79f0\u4e3a guard \u548c round\uff0c\u5176\u4e3b\u8981\u76ee\u7684\u662f\u8ba9\u8ba1\u7b97\u7ed3\u679c\u7684\u820d\u5165\u66f4\u52a0\u7684\u7cbe\u786e\uff1a </p> <p> </p> <p>\u4e8b\u5b9e\u4e0a\u52a0\u6cd5\u53ea\u9700\u8981\u7528\u5230 guard\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e58\u6cd5\uff0c\u5982\u679c\u5b58\u5728\u524d\u5bfc 0\uff0c\u9700\u8981\u5c06\u7ed3\u679c\u5de6\u79fb\uff0c\u8fd9\u65f6\u5019 round bit \u5c31\u6210\u4e86\u6709\u6548\u4f4d\uff0c\u80fd\u907f\u514d\u7cbe\u5ea6\u7684\u635f\u5931\u3002</p> <p>\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u4f4d\u53eb sticky bit\uff0c\u5176\u5b9a\u4e49\u662f\uff1a\u53ea\u8981 round \u53f3\u8fb9\u6709\u975e\u96f6\u4f4d\uff0c\u5c31\u5c06 sticky \u7f6e 1\uff0c\u8fd9\u4e00\u70b9\u53ef\u4ee5\u7528\u5728\u52a0\u6cd5\u7684\u53f3\u79fb\u4e2d\uff0c\u53ef\u4ee5\u8bb0\u4f4f\u662f\u5426\u6709 1 \u88ab\u79fb\u51fa\uff0c\u4ece\u800c\u80fd\u591f\u5b9e\u73b0 \"round to nearest even\"\u3002</p>"},{"location":"4-x/","title":"4 \u5904\u7406\u5668 | Processor","text":"<p> \u7ea6 4344 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 22 \u5206\u949f</p> <p>Warning</p> <p>\u7531\u4e8e\u65f6\u95f4\u539f\u56e0\uff0c\u672c\u6587\u540e\u534a\u90e8\u5206\u6709\u4e00\u4e9b\u5730\u65b9\u4e0d\u5b8c\u6574\u3002</p> <p>\u6211\u4eec\u8ba8\u8bba\u8fc7\uff0c\u8ba1\u7b97\u673a\u7684 performance \u53d7 inst#, clock cycle time \u548c clock cycles per inst (CPI) \u51b3\u5b9a\u3002Clock cycle time \u548c CPI \u53d7 processor \u7684\u5b9e\u73b0\u65b9\u5f0f\u5f71\u54cd\u3002\u672c\u7ae0\u4ecb\u7ecd RISC-V \u7684 processor \u4e00\u79cd\u5b9e\u73b0\u3002</p>"},{"location":"4-x/#41-datapath","title":"4.1 Datapath","text":""},{"location":"4-x/#411-overview","title":"4.1.1 Overview","text":"<p>\u4e0a\u56fe\u5c55\u793a\u4e86\u4e00\u4e2a RISC-V \u6838\u5fc3\u6307\u4ee4\u7684\u5b9e\u73b0\uff08\u5e76\u4e0d\u5b8c\u6574\uff09\uff0c\u5305\u62ec  <code>ld</code>  ,   <code>sd</code>  ,   <code>add</code>  ,   <code>sub</code>  ,   <code>and</code>  ,   <code>or</code>  ,   <code>beq</code>  \u3002\u6211\u4eec\u7b80\u5355\u8fdb\u884c\u5206\u6790\u3002</p> <ul> <li>PC \u5bc4\u5b58\u5668\u5b58\u50a8\u5f53\u524d\u8fd0\u884c\u5230\u7684\u6307\u4ee4\u7684\u5730\u5740\u3002PC \u5bc4\u5b58\u5668\u8fde\u5230 Instruction memory \u4e2d\uff0c\u8bfb\u51fa\u7684\u7ed3\u679c\u5c31\u662f\u5f53\u524d\u8981\u8fd0\u884c\u7684\u6307\u4ee4\u3002\u8fd9\u4e2a\u6307\u4ee4\u88ab Control \u89e3\u6790\u4ea7\u751f\u76f8\u5e94\u7684\u4fe1\u53f7\u3002\u6211\u4eec\u5728 4.1.6 \u5c0f\u8282\u4e2d\u5177\u4f53\u8bf4\u660e\u5b83\u7684\u5b9e\u73b0\u3002</li> </ul>"},{"location":"4-x/#412-r-\u578b\u6307\u4ee4","title":"4.1.2 R \u578b\u6307\u4ee4","text":"<ul> <li><code>add</code>  ,   <code>sub</code>  ,   <code>and</code>  ,   <code>or</code>  \u8fd9\u51e0\u4e2a R \u578b\u6307\u4ee4\u603b\u5171\u9700\u8981\u8bbf\u95ee 3 \u4e2a\u5bc4\u5b58\u5668\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</li> </ul> <ul> <li>(1) \u5904\u53d6\u51fa\u6307\u4ee4\uff0c  <code>[6:0]</code>  \u88ab\u9001\u5230 Control \u4ea7\u751f\u5bf9\u5e94\u7684\u63a7\u5236\u4fe1\u53f7\uff0c\u6211\u4eec\u7a0d\u540e\u53ef\u4ee5\u770b\u5230\uff1b  <code>[19:15]</code>  ,   <code>[24:20]</code>  ,   <code>[11:7]</code>  \u5206\u522b\u5bf9\u5e94  <code>rs1</code>  ,  <code>rs2</code>  ,  <code>rd</code>  \uff0c\u88ab\u8fde\u5165 Registers \u8fd9\u4e2a\u7ed3\u6784\uff0c\u5bf9\u5e94\u5730  <code>Read data 1</code>  \u548c  <code>Read data 2</code>  \u4e24\u5904\u7684\u503c\u5373\u53d8\u4e3a  <code>rs1</code>  ,  <code>rs2</code>  \u7684\u503c\uff1b</li> <li>(2) \u5904 MUX \u5728  <code>ALUSrc = 0</code>  \u7684\u4fe1\u53f7\u4f5c\u7528\u4e0b\u9009\u62e9  <code>Read data 2</code>  \u4f5c\u4e3a ALU \u7684\u8f93\u5165\u4e0e  <code>Read data 1</code>  \u8fdb\u884c\u8fd0\u7b97\uff0c\u5177\u4f53\u7684\u8fd0\u7b97\u7531  <code>ALU control</code>  \u63d0\u4f9b\u7684\u4fe1\u53f7\u6307\u660e\uff08\u6211\u4eec\u5728 4.1.3 \u5c0f\u8282 \u8ba8\u8bba\u8fd9\u4e2a\u8bdd\u9898\uff09\u3002\u8fd0\u7b97\u7ed3\u679c\u5728  <code>ALU result</code>  \u4e2d\u3002</li> <li>(3) \u5904 MUX \u5728  <code>MemtoReg = 0</code>  \u7684\u4fe1\u53f7\u4f5c\u7528\u4e0b\u9009\u62e9  <code>ALU result</code>  \u4f5c\u4e3a\u5199\u56de Register \u7684\u503c\uff0c\u8fde\u5230 (4) \u5904\uff1b\u5728 (5) \u5904  <code>RegWrite = 1</code>  \u4fe1\u53f7\u63a7\u5236\u4e0b\uff0c\u8be5\u503c\u5199\u5165\u5230  <code>rd</code>  \u5bc4\u5b58\u5668\u4e2d\u3002</li> </ul> <p>\u8fd9\u5c31\u662f R \u578b\u6307\u4ee4\u7684\u8fd0\u884c\u8fc7\u7a0b\u3002\u6267\u884c\u5b8c\u6307\u4ee4\u540e PC \u4f1a +4\uff0c\u6211\u4eec\u5728 4.1.4 \u5c0f\u8282 \u8ba8\u8bba\u8fd9\u4e00\u64cd\u4f5c\u7684\u5b9e\u73b0\u3002</p> <p>Info</p> <p>\u6709\u806a\u660e\u7684\u5c0f\u670b\u53cb\u53ef\u80fd\u4f1a\u95ee\uff0c\u4e3a\u4ec0\u4e48\u9700\u8981  <code>RegWrite</code>  \u8fd9\u4e2a\u63a7\u5236\u4fe1\u53f7\u5462\uff1f\u975e\u5e38\u7b80\u5355\uff0c\u56e0\u4e3a  <code>Write register</code>  \u548c  <code>Write data</code>  \u8fd9\u4e24\u6761\u7ebf\u59cb\u7ec8\u662f\u8fde\u7740\u7684\uff0cReg files \u9700\u8981\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u9700\u8981\u5199\u5165\u5bc4\u5b58\u5668\uff0c\u56e0\u6b64\u53ea\u6709\u5f53  <code>RegWrite = 1</code>  \u65f6\u624d\u4f1a\u88ab\u5bf9\u5e94\u5730\u5199\u5165\u3002</p> <p>\u806a\u660e\u7684\u5c0f\u670b\u53cb\u53ef\u80fd\u53c8\u4f1a\u95ee\u4e86\uff0c\u4e3a\u4ec0\u4e48  <code>PC</code>  \u5bc4\u5b58\u5668\u4e5f\u8981\u5199\u5165\uff0c\u4f46\u662f\u4e0d\u9700\u8981\u63a7\u5236\u4fe1\u53f7\u5462\uff1f\u975e\u5e38\u7b80\u5355\uff0c\u56e0\u4e3a  <code>PC</code>  \u5728 \u6bcf\u4e2a \u65f6\u949f\u5468\u671f\u90fd\u4f1a\u88ab\u5199\u5165\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5728\u65f6\u949f\u7684 \u6bcf\u4e2a \u4e0a\u5347\u6cbf\u6216\u8005\u4e0b\u964d\u6cbf\u89e6\u53d1\u5c31\u597d\u4e86\uff08\u6211\u4eec\u91c7\u53d6\u7684\u8bbe\u8ba1\u662f\u4e0b\u964d\u6cbf\u89e6\u53d1\uff0c\u6211\u4eec\u5728 4.2.3 \u5c0f\u8282 \u518d\u8ba8\u8bba\u4e3a\u4ec0\u4e48\u8fd9\u6837\u8bbe\u8ba1\uff09\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u63a7\u5236\u4fe1\u53f7\u4e86\u3002</p>"},{"location":"4-x/#413-alu-control","title":"4.1.3 ALU Control","text":"<p>\u5728 3.1 \u8282\u4e2d\uff0c\u6211\u4eec\u8bbe\u8ba1\u7684 ALU \u9700\u8981\u8fd9\u6837\u7684\u63a7\u5236\u7ed3\u6784\uff1a</p> <p></p> <p>\u6211\u4eec\u5217\u4e00\u4e0b\u9700\u8981\u4f7f\u7528 ALU \u7684\u6307\u4ee4\u7684\u8868\u683c\uff08\u6211\u4eec\u5728\uff09\uff1a</p> <p></p> <p>\u6211\u4eec\u6839\u636e\u8fd9\u4e2a\u8868\u5217\u51fa\u771f\u503c\u8868\uff1a</p> <p></p> <p>\u5176\u4e2d\u53ef\u4ee5\u53d1\u73b0\uff0c\u6807\u4e3a\u7eff\u8272\u7684\u5217\u7684\u53d6\u503c\u8981\u4e48\u662f 0 \u8981\u4e48\u662f\u65e0\u5173\u7684\uff0c\u56e0\u6b64\u5b83\u4eec\u5e76\u4e0d\u5f71\u54cd\u7ed3\u679c\u3002</p> <p>\u6839\u636e\u8fd9\u4e2a\u771f\u503c\u8868\u6784\u9020\u95e8\u7535\u8def\uff0c\u5c31\u53ef\u4ee5\u6784\u9020\u51fa ALU control \u5355\u5143\u4e86\u3002\u5982\u56fe\u4e2d\u6240\u793a\uff0c\u8be5\u5355\u5143\u4f9d\u8d56 Control \u5355\u5143\u7ed9\u51fa\u7684  <code>ALUOp</code>  \u4fe1\u53f7\u4ee5\u53ca  <code>I[30, 14:2]</code>  \uff1a</p> <p></p> <p>Info</p> <p>ALU control \u6a21\u5757\u53ef\u4ee5\u8fd9\u6837\u5b9e\u73b0\uff1a</p> <p></p> <p>\u9700\u8981\u7406\u89e3\u7684\u662f\uff0c\u6211\u4eec\u5e76\u4e0d\u662f\u6839\u636e\u673a\u5668\u7801\u6765\u6784\u9020\u7535\u8def\u7684\uff0c\u800c\u662f\u76f8\u53cd\uff1a\u7535\u8def\u7684\u8bbe\u8ba1\u53c2\u8003\u4e86\u5f88\u591a\u65b9\u9762\u7684\u95ee\u9898\uff0c\u673a\u5668\u7801\u5e94\u5f53\u4e3b\u8981\u8fce\u5408\u7535\u8def\u4f7f\u5176\u8bbe\u8ba1\u66f4\u52a0\u65b9\u4fbf\u3002</p>"},{"location":"4-x/#414-\u8df3\u8f6c\u6307\u4ee4\u4e0e-imm-gen-\u6a21\u5757","title":"4.1.4 \u8df3\u8f6c\u6307\u4ee4\u4e0e Imm Gen \u6a21\u5757","text":"<ul> <li>\u5728\u4e00\u6761\u6307\u4ee4\u8fd0\u884c\u5b8c\u540e\uff0c\u5982\u679c\u4e0d\u53d1\u751f\u8df3\u8f6c\uff0cPC + 4\uff0c\u5426\u5219 PC \u8df3\u8f6c\u5230 PC + offset \u7684\u4f4d\u7f6e\u53bb\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5982\u4f55\u5b8c\u6210\u7684\u5462\uff1f\u770b\u4e0b\u56fe\uff1a</li> </ul> <ul> <li>(1) \u4e2d\u6709\u4e24\u4e2a\u52a0\u6cd5\u5668\uff0c\u4e00\u4e2a\u7684\u7ed3\u679c\u662f PC + 4\uff0c\u53e6\u4e00\u4e2a\u662f PC + offset\uff0c\u5176\u4e2d offset \u662f\u6765\u81ea\u5f53\u524d instruction \u7684\uff1b\u8fd9\u4e24\u4e2a\u52a0\u6cd5\u5668\u901a\u8fc7 MUX \u9001\u7ed9 PC</li> <li>MUX \u7684\u63a7\u5236\u4fe1\u53f7\u6765\u81ea  (2)\uff0c (2) \u662f\u4e00\u4e2a\u4e0e\u95e8\uff0c\u5373\u5f53\u4e14\u4ec5\u5f53\u4e24\u4e2a\u8f93\u5165\u4fe1\u53f7\u90fd\u4e3a\u771f\u65f6\u624d\u4f1a\u8f93\u51fa 1\uff0c\u4ece\u800c\u5728\u4e0a\u8ff0 MUX \u4e2d\u9009\u62e9\u8df3\u8f6c\u3002 (2) \u7684\u4e24\u4e2a\u8f93\u5165\u5206\u522b\u6765\u81ea\uff1a<ul> <li>(5) \u8fd9\u4e2a ALU \u7684 Zero \u4fe1\u53f7\uff0c\u8fd9\u662f\u7b2c 3 \u7ae0\u4e2d\u6211\u4eec\u8bbe\u8ba1\u7684\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0  <code>beq</code>  \u7684\u7ed3\u6784\uff1b\u6211\u4eec\u8ba8\u8bba\u8fc7\u5b9e\u73b0  <code>beq</code>  \u5176\u5b9e\u5c31\u662f\u8ba1\u7b97  <code>rs1 - rs2</code>  \u5224\u65ad\u5176\u662f\u5426\u4e3a 0\uff0c\u6240\u4ee5\u8fd9\u91cc\u6839\u636e Zero \u662f\u5426\u4e3a 0 \u5c31\u80fd\u5224\u65ad\u4e24\u4e2a\u5bc4\u5b58\u5668\u662f\u5426\u76f8\u7b49</li> <li>(4) \u5904 Control \u7ed9\u51fa\u7684  <code>Branch</code>  \u4fe1\u53f7\uff0c\u5373\u5982\u679c\u8fd9\u4e2a\u8bed\u53e5\u662f\u8df3\u8f6c\u8bed\u53e5\uff0c\u90a3\u4e48\u5bf9\u5e94\u7684\u4fe1\u53f7\u4f1a\u7f6e\u4e3a 1</li> </ul> </li> </ul> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u4e14\u4ec5\u5f53\u8bed\u53e5\u786e\u5b9e\u662f  <code>beq</code>  \u800c\u4e14  <code>Zero</code>  \u4fe1\u53f7\u7684\u503c\u786e\u5b9e\u4e3a 1 \u65f6\u624d\u4f1a\u8fdb\u884c\u8df3\u8f6c\u3002</p> <ul> <li>\u518d\u6765\u770b\u770b\u5f53\u8fdb\u884c\u8df3\u8f6c\u7684\u65f6\u5019\uff0c (3) \u5904\u7684 offset \u6765\u81ea\u54ea\u91cc\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5b9e\u9645\u4e0a\u8fd9\u4e2a offset \u6765\u81ea\u4e8e  <code>I[31:0]</code>  \uff0c\u4e5f\u5c31\u662f\u6574\u4e2a\u6307\u4ee4\uff1b\u5b83\u88ab\u4f20\u7ed9 Imm Gen \u6a21\u5757\uff0c\u5c06\u6307\u4ee4\u4e2d\u7684\u7acb\u5373\u6570\u7b26\u53f7\u6269\u5c55\u5230 64 \u4f4d\uff1b\u7136\u540e\u5728  (3) \u5904\u5de6\u79fb 1 \u4f4d\uff08\u8bf7\u56de\u987e\uff0c\u56e0\u4e3a RISC-V \u6307\u4ee4\u603b\u662f 2 \u5b57\u8282\u5bf9\u9f50 [\u6211\u4eec\u5b66\u7684\u90fd\u662f 4 \u5b57\u8282\u5bf9\u9f50]\uff0c\u6240\u4ee5\u6211\u4eec\u6ca1\u6709\u4fdd\u5b58\u504f\u79fb\u7684\u6700\u4f4e\u4e00\u4f4d\uff09\u518d\u4e0e PC \u76f8\u52a0\u3002</li> </ul> <p>Imm Gen \u6a21\u5757</p> <p>\u8fd9\u4e2a\u6a21\u5757\u8bc6\u522b  <code>load</code>  \u7c7b\u6307\u4ee4\u3001  <code>store</code>  \u7c7b\u6307\u4ee4\u548c  <code>branch</code>  \u7c7b\u6307\u4ee4\u7684\u7acb\u5373\u6570\u6a21\u5f0f\u5e76\u5c06\u5176 \u7b26\u53f7\u6269\u5c55 \u5230 64 \u4f4d\uff0c\u6839\u636e  <code>I[5:6]</code>  \u7684\u4e0d\u540c\u53d6\u503c\u533a\u5206\u8fd9\u4e09\u79cd\u60c5\u51b5\uff0c\u6784\u9020\u4e00\u4e2a 3:1 MUX \u9009\u62e9\u5b9e\u9645\u7684\u7acb\u5373\u6570\uff0c\u5c06\u5176\u4f20\u7ed9\u540e\u9762\u7684\u4f7f\u7528\u3002</p>"},{"location":"4-x/#415-load-\u6307\u4ee4\u548c-store-\u6307\u4ee4","title":"4.1.5 Load \u6307\u4ee4\u548c Store \u6307\u4ee4","text":"<p>\u61d2\u5f97\u5199\u4e86\uff0c\u53ef\u4ee5\u81ea\u5df1\u7406\u89e3\u4e00\u4e0b\u3002</p> <p>\u7528\u6587\u5316\u4eba\u7684\u8bdd\u6765\u8bf4\uff0cLoad \u6307\u4ee4\u548c Store \u6307\u4ee4\u7684\u6570\u636e\u901a\u8def\u64cd\u4f5c\u7559\u4f5c\u4e60\u9898\u3002</p>"},{"location":"4-x/#416-control","title":"4.1.6 Control","text":"<p>\u770b\u5b8c\u4e0a\u8ff0\u82e5\u5e72\u5c0f\u8282\uff0ccontrol \u5355\u5143\u7684\u8bbe\u8ba1\u4e5f\u975e\u5e38\u663e\u7136\u4e86\u3002\u6211\u4eec\u5f88\u5bb9\u6613\u7ed9\u51fa\u5982\u4e0b\u771f\u503c\u8868\uff1a</p> <p></p> <p>\u540e\u9762\u5c31\u662f\u8fde\u7535\u8def\u7684\u5de5\u4f5c\u4e86\u3002\u8fde\u51fa\u6765\u957f\u8fd9\u6837\uff1a</p> <p></p>"},{"location":"4-x/#417-why-a-single-cycle-implementation-is-not-used-today","title":"4.1.7 Why a Single-Cycle Implementation is not Used Today","text":"<p>\u5355\u5468\u671f\u7684\u5b9e\u73b0\u662f\u6307\uff0c\u4e00\u4e2a\u6307\u4ee4\u7684\u6240\u6709\u5de5\u4f5c\u90fd\u5728\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u5185\u5b8c\u6210\uff0c\u4e5f\u5c31\u662f CPI = 1\u3002\u90a3\u4e48\uff0c\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u7684\u957f\u5ea6\u5c31\u8981\u8db3\u591f\u6700\u957f\u7684\u90a3\u4e2a\u6307\u4ee4\u5b8c\u6210\u8fd0\u884c\u3002\u4f46\u662f\uff0c\u4f8b\u5982  <code>load</code>  \u7c7b\u7684\u6307\u4ee4\u8981\u7ecf\u8fc7 inst mem, reg file, ALU, data mem, reg file \u8fd9\u4e48\u591a\u7684\u6b65\u9aa4\uff0c\u8fd9\u4f1a\u4f7f\u5f97\u65f6\u949f\u5468\u671f\u53d8\u5f97\u5f88\u957f\uff0c\u5bfc\u81f4\u6574\u4f53\u6027\u80fd\u53d8\u5f97\u5f88\u5dee\u3002\u5355\u5468\u671f\u7684\u5b9e\u73b0\u8fdd\u53cd\u4e86 common case fast \u8fd9\u4e00\u8bbe\u8ba1\u539f\u5219\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u5f15\u5165\u4e00\u79cd\u65b0\u7684\u5b9e\u73b0\u6280\u672f\uff0c\u53eb \u6d41\u6c34\u7ebf (Pipeline)\u3002</p>"},{"location":"4-x/#42-pipeline","title":"4.2 Pipeline","text":""},{"location":"4-x/#421-intro","title":"4.2.1 Intro","text":"<p>\u5728\u5c0f\u5b66\u5965\u6570\u4e2d\u6211\u4eec\u5c31\u5b66\u8fc7\uff0c\u5e76\u884c\u80fd\u591f\u63d0\u9ad8\u6574\u4f53\u7684\u6548\u7387\uff0c\u4f8b\u5982\u8fd9\u4e2a\u6d17\u8863\u670d\u7684\u4f8b\u5b50\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u5355\u4e2a\u5de5\u4f5c\uff0c\u6d41\u6c34\u7ebf\u6280\u672f\u5e76\u6ca1\u6709\u7f29\u77ed\u5176\u8fd0\u884c\u65f6\u95f4\uff1b\u4f46\u662f\u7531\u4e8e\u591a\u4e2a\u5de5\u4f5c\u53ef\u4ee5\u5e76\u884c\u5730\u6267\u884c\uff0c\u6d41\u6c34\u7ebf\u6280\u672f\u53ef\u4ee5\u66f4\u597d\u5730\u538b\u69a8\u8d44\u6e90\uff0c\u4f7f\u5f97\u5b83\u4eec\u88ab\u540c\u65f6\u800c\u4e0d\u662f\u8f6e\u6d41\u4f7f\u7528\uff0c\u5728\u5de5\u4f5c\u6bd4\u8f83\u591a\u7684\u65f6\u5019\u53ef\u4ee5\u589e\u52a0\u6574\u4f53\u7684 \u541e\u5410\u7387 throughput\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u5b8c\u6210\u6574\u4e2a\u4efb\u52a1\u7684\u65f6\u95f4\u3002</p> <p>\u5728\u672c\u4f8b\u4e2d\uff0c\u7531\u4e8e\u6d41\u6c34\u7ebf\u5f00\u59cb\u548c\u7ed3\u675f\u7684\u65f6\u5019\u5e76\u6ca1\u6709\u5b8c\u5168\u5145\u6ee1\uff0c\u56e0\u6b64\u541e\u5410\u7387\u4e0d\u53ca\u539f\u6765\u7684 4 \u500d\uff1b\u4f46\u662f\u5f53\u5de5\u4f5c\u6570\u8db3\u591f\u591a\u7684\u65f6\u5019\uff0c\u541e\u5410\u7387\u5c31\u51e0\u4e4e\u662f\u539f\u6765\u7684 4 \u500d\u4e86\u3002</p> <p>\u56de\u5230 RISC-V \u4e2d\u6765\uff0c\u4e00\u4e2a\u6307\u4ee4\u901a\u5e38\u5305\u542b 5 \u4e2a\u9636\u6bb5\uff1a</p> <ol> <li>IF, Inst Fetch\uff0c\u4ece\u5185\u5b58\u4e2d\u83b7\u53d6\u6307\u4ee4</li> <li>ID, Inst Decode\uff0c\u8bfb\u53d6\u5bc4\u5b58\u5668\u3001\u6307\u4ee4\u8bd1\u7801</li> <li>EX, Execute\uff0c\u8ba1\u7b97\u64cd\u4f5c\u7ed3\u679c\u548c/\u6216\u5730\u5740</li> <li>MEM, Memory\uff0c\u5185\u5b58\u5b58\u53d6\uff08\u5982\u679c\u9700\u8981\u7684\u8bdd\uff09</li> <li>WB, Write Back\uff0c\u5c06\u7ed3\u679c\u5199\u56de\u5bc4\u5b58\u5668\uff08\u5982\u679c\u9700\u8981\u7684\u8bdd\uff09</li> </ol> <p>\u5404\u9636\u6bb5\u4f1a\u7528\u5230\u7684\u7ec4\u4ef6\u5982\u4e0b\u56fe\u6240\u793a\uff08\u8fd9\u4e2a\u56fe\u8fd8\u6709\u5f88\u591a\u95ee\u9898\uff0c\u6211\u4eec\u540e\u9762\u6162\u6162\u8ba8\u8bba~\uff09\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e9b\u90e8\u5206\u662f\u53ef\u4ee5\u5e76\u884c\u6267\u884c\u7684\uff08\u6bd4\u5982 Reg File \u53ef\u4ee5\u4e00\u8fb9\u8bfb\u4e00\u8fb9\u5199\uff09\uff1a</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u672c\u6765\u662f\u5728\u4e00\u4e2a\u5468\u671f\u4e2d\u5b8c\u6210\u4e00\u4e2a\u6307\u4ee4\uff0c\u800c\u73b0\u5728\u662f\u5728\u4e00\u4e2a\u5468\u671f\u4e2d\u5b8c\u6210\u4e00\u4e2a\u9636\u6bb5\u3002\u6240\u4ee5\uff0c\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u7684\u957f\u5ea6\u4e5f\u9700\u8981\u8db3\u591f\u4efb\u4f55\u4e00\u4e2a\u9636\u6bb5\u5b8c\u6210\u6267\u884c\u3002</p> <p>RISC-V \u4e5f\u6709\u5f88\u591a\u6d41\u6c34\u7ebf\u53cb\u597d\u7684\u8bbe\u8ba1\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u6240\u6709 RISC-V \u7684\u6307\u4ee4\u957f\u5ea6\u76f8\u540c\uff0c\u8fd9\u53ef\u4ee5\u65b9\u4fbf  <code>IF</code>  \u548c  <code>ID</code>  \u7684\u5de5\u4f5c</li> <li>RISC-V \u7684\u6307\u4ee4\u683c\u5f0f\u6bd4\u8f83\u5c11\uff0c\u800c\u4e14\u6e90\u5bc4\u5b58\u5668\u3001\u76ee\u6807\u5bc4\u5b58\u5668\u7684\u4f4d\u7f6e\u76f8\u540c</li> <li>\u53ea\u5728 load \u6216 store \u6307\u4ee4\u4e2d\u64cd\u4f5c data memory \u800c\u4e0d\u4f1a\u5c06\u5b58\u53d6\u7684\u7ed3\u679c\u505a\u8fdb\u4e00\u6b65\u8fd0\u7b97\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06  <code>MEM</code>  \u653e\u5728\u6bd4\u8f83\u540e\u9762\u7684\u4f4d\u7f6e\uff1b\u5982\u679c\u8fd8\u80fd\u5bf9\u7ed3\u679c\u505a\u8fd0\u7b97\u5219\u8fd8\u9700\u8981\u4e00\u4e2a\u989d\u5916\u7684\u9636\u6bb5\uff0c\u6d41\u6c34\u7ebf\u8f83\u957f\u662f\u4e0d\u597d\u7684</li> </ul>"},{"location":"4-x/#422-datapath","title":"4.2.2 Datapath","text":"<p>\u4f46\u662f\uff0c\u806a\u660e\u7684\u5c0f\u670b\u53cb\u4e5f\u53ef\u4ee5\u770b\u51fa\u4e00\u4e9b\u95ee\u9898\uff01\u6bd4\u5982\uff0c\u524d\u4e00\u4e2a\u6307\u4ee4\u5728  <code>ID</code>  \u9636\u6bb5\u7684\u65f6\u5019\uff0c\u4f1a\u4f7f\u7528\u5230\u5176\u5728  <code>IF</code>  \u9636\u6bb5\u8bfb\u51fa\u7684\u6307\u4ee4\u7684\u5185\u5bb9\uff1b\u4f46\u4e0e\u6b64\u540c\u65f6\u540e\u4e00\u4e2a\u6307\u4ee4\u5df2\u7ecf\u8fd0\u884c\u5230  <code>IF</code>  \u9636\u6bb5\u5e76\u8bfb\u51fa\u4e86\u65b0\u7684\u6307\u4ee4\uff0c\u90a3\u4e48\u524d\u4e00\u4e2a\u6307\u4ee4\u5c31\u6ca1\u7684\u7528\u4e86\uff01\u8fd9\u4e2a\u73b0\u8c61\u5728\u5f88\u591a\u5730\u65b9\u666e\u904d\u5b58\u5728\uff0c\u5305\u62ec Control \u4fe1\u53f7\u7684\u4f20\u9012\uff0c\u56e0\u6b64\u6211\u4eec\u5b9e\u9645\u4e0a\u4f1a\u5728\u6bcf\u4e24\u4e2a stage \u4e4b\u95f4\u7528\u4e00\u4e9b\u5bc4\u5b58\u5668\u4fdd\u5b58\u8fd9\u4e9b\u5185\u5bb9\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u8fd9\u4e2a\u56fe\u9664\u4e86\u52a0\u4e86\u4e00\u4e9b\u7ad6\u6761\u6761\u4ee5\u5916\u548c\u4e4b\u524d\u6ca1\u6709\u6d41\u6c34\u7ebf\u7684\u65f6\u5019\u51e0\u4e4e\u6ca1\u4ec0\u4e48\u5dee\u522b\u3002\u8fd9\u4e9b\u7ad6\u6761\u6761\u5c31\u662f pipeline registers\uff0c\u4f8b\u5982  <code>IF/ID</code>  \u5c31\u662f  <code>IF</code>  \u548c  <code>ID</code>  \u9636\u6bb5\u4e4b\u95f4\u7684\u4e00\u4e9b\u5bc4\u5b58\u5668\u3002</p> <p>Info</p> <p>\u806a\u660e\u7684\u5c0f\u670b\u53cb\u53ef\u80fd\u4f1a\u56de\u5fc6\u8d77\u6211\u4eec\u5728 4.1.2 \u5c0f\u8282 \u4e2d\u63d0\u5230\u7684\uff0c\u7531\u4e8e PC \u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u90fd\u4f1a\u88ab\u5199\u5165\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u50cf Reg files \u548c Data mem \u90a3\u6837\u9700\u8981\u989d\u5916\u7684\u63a7\u5236\u4fe1\u53f7  <code>RegWrite</code>  \u548c  <code>MemWrite</code>  \u6765\u63a7\u5236\u5199\u5165\uff0c\u53ea\u9700\u8981\u5728\u6bcf\u4e2a\u4e0b\u964d\u6cbf\u5199\u5165\u5c31\u597d\u3002Pipeline registers \u4e5f\u662f\u8fd9\u6837\uff0c\u5b83\u4eec\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u90fd\u4f1a\u88ab\u5199\u5165\u4e00\u6b21\uff0c\u6240\u4ee5\u4e5f\u4e0d\u9700\u8981\u989d\u5916\u7684\u4fe1\u53f7\uff0c\u4e5f\u662f\u5728\u6bcf\u4e2a\u4e0b\u964d\u6cbf\u5199\u5165\u5c31\u597d\u3002</p> <p>\u6211\u4eec\u4e4b\u524d\u5e76\u6ca1\u6709\u8ba8\u8bba\u4e3a\u4ec0\u4e48\u8981\u5728\u4e0b\u964d\u6cbf\u5199\u5165\uff0c\u672c\u8282\u4e0b\u4e00\u4e2a Info \u6846\u6846\u5c31\u4f1a\u8bf4\u660e\u5566\uff01</p> <p>\u6211\u4eec\u5173\u6ce8 datapath \u4e2d\u4e24\u4e2a\u4ece\u53f3\u5f80\u5de6\u4f20\u4e1c\u897f\u7684\u60c5\u51b5\uff01\u4e00\u4e2a\u662f  <code>WB</code>  \u9636\u6bb5\u5199\u56de\u6570\u636e\uff0c\u4e00\u4e2a\u662f  <code>MEM</code>  \u9636\u6bb5\u5224\u65ad\u662f\u5426\u53d1\u751f\u8df3\u8f6c\u3002\u5206\u522b\u5173\u6ce8\u5bf9\u5e94\u589e\u52a0\u7684 datapath\uff1a</p> <p></p> <p>\u5bf9\u4e8e  <code>WB</code>  \u6765\u8bf4\uff0c\u6211\u4eec\u5199\u4f1a\u65f6\u9700\u8981\u8bb0\u5f55\u5199\u5230\u54ea\u4e2a register \u4e2d\uff0c\u8fd9\u4e2a\u4fe1\u606f\u662f  <code>ID</code>  \u9636\u6bb5\u4ece Instruction \u4e2d  <code>[11:7]</code>  \u7684\u4f4d\u7f6e\u53d6\u51fa\u7684\uff0c\u4f46\u662f\u76f4\u5230  <code>WB</code>  \u9636\u6bb5\u624d\u88ab\u7528\u5230\uff0c\u56e0\u6b64\u8fd9\u4e2a\u4fe1\u606f\u88ab\u5b58\u5230\u4e86  <code>ID/EX</code>  \uff0c\u4e0b\u4e00\u4e2a\u5468\u671f\u5b58\u5230\u4e86  <code>EX/MEM</code>  \uff0c\u4e0b\u4e00\u4e2a\u5468\u671f\u5b58\u5230\u4e86  <code>MEM/WB</code>  \uff0c\u7136\u540e\u4e0b\u4e00\u4e2a\u5468\u671f\u88ab\u4f7f\u7528\u3002</p> <p><code>MEM</code>  \u5224\u65ad\u662f\u5426\u53d1\u751f\u8df3\u8f6c\u7684\u903b\u8f91\u7c7b\u4f3c\uff0c\u7565\u3002</p>"},{"location":"4-x/#423-data-hazards","title":"4.2.3 Data Hazards","text":"<p>\u4f46\u662f\uff0c\u806a\u660e\u7684\u5c0f\u670b\u53cb\u4ecd\u7136\u53ef\u4ee5\u770b\u51fa\u4e00\u4e9b\u95ee\u9898\uff01\u8003\u8651\u8fd9\u6837\u7684\u6307\u4ee4\u5e8f\u5217\uff1a</p> <p></p> <p>\u7528\u7b80\u5316\u7684\u6570\u636e\u901a\u8def\u67e5\u770b\u4e00\u4e0b\u5404\u6307\u4ee4\u5404 stage \u7684\u6267\u884c\u65f6\u95f4\uff1a</p> <p></p> <p>\u6211\u4eec\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u5f20\u56fe\u3002\u6700\u4e0a\u9762\u662f\u6a2a\u8f74\uff0c\u4e5f\u5c31\u662f\u65f6\u95f4\u8f74\uff0cCC \u4ee3\u8868 Clock Cycle\uff1b\u4e0b\u9762\u7684 10, -20 \u8fd9\u79cd\u6570\u636e\u662f  <code>x2</code>  \u5bc4\u5b58\u5668\u7684\u503c\uff1b\u63a5\u4e0b\u6765\u7684\u6bcf\u4e00\u884c\u90fd\u662f\u4e00\u4e2a\u8bed\u53e5\u7684\u6267\u884c\u8fc7\u7a0b\uff0c  <code>IM</code>  \u5c31\u662f inst mem\uff0c\u5bf9\u5e94  <code>IF</code>  stage\uff1b  <code>Reg</code>  \u5c31\u662f reg file\uff0c\u5bf9\u5e94  <code>ID</code>  stage\uff1b\u957f\u5f97\u50cf ALU \u7684\u5c31\u662f ALU\uff0c\u5bf9\u5e94  <code>EX</code>  stage\uff1b  <code>DM</code>  \u5c31\u662f data mem\uff0c\u5bf9\u5e94  <code>MEM</code>  stage\uff1b\u6700\u540e\u9762\u7684  <code>Reg</code>  \u4e5f\u662f reg file\uff0c\u5bf9\u5e94  <code>WB</code>  stage\u3002\u6bcf\u4e2a stage \u5360\u7528\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u3002</p> <p>\u56fe\u4e2d\u6df1\u8272\uff08\u7070\u8272\u3001\u84dd\u8272\uff09\u7684\u90e8\u5206\u5c31\u662f\u5bf9\u5e94\u6307\u4ee4\u4f1a\u4f7f\u7528\u5230\u7684\u7ec4\u4ef6\uff0c\u5176\u4e2d mem \u548c reg file \u7528\u5de6\u534a\u8fb9\u4e3a\u6df1\u8272\u8868\u793a \u5199\u5165\uff0c\u53f3\u534a\u8fb9\u4e3a\u6df1\u8272\u8868\u793a \u8bfb\u53d6\u3002\u6211\u4eec\u7a0d\u540e\u89e3\u91ca\u8fd9\u6837\u8868\u793a\u7684\u539f\u56e0\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u7b2c\u4e00\u6761\u8bed\u53e5  <code>sub x2, x1, x3</code>  \u8fd0\u884c\u5230\u7b2c 5 \u4e2a\u65f6\u949f\u5468\u671f\u65f6\uff0c\u8ba1\u7b97\u7ed3\u679c\u624d\u88ab\u5199\u56de  <code>x2</code>  \uff08\u5982\u7eff\u8272\u6846\u6846\u6240\u793a\uff09\uff0c\u4f46\u662f\u5728\u7b2c 3 \u4e2a\u5468\u671f\u65f6\u7b2c\u4e8c\u6761\u8bed\u53e5  <code>and x12, x2, x5</code>  \u5c31\u8fd0\u884c\u5230  <code>ID</code>  \u9636\u6bb5\uff0c\u9700\u8981\u7528\u5230  <code>x2</code>  \u7684\u503c\uff08\u5982\u6a59\u8272\u6846\u6846\u6240\u793a\uff09\u3002\u5982\u679c\u8fd9\u65f6\u5019\u4e0d\u52a0\u5904\u7406\uff0c\u7b2c\u4e8c\u6761\u8bed\u53e5\u8bfb\u5230\u7684\u503c\u5c31\u662f\u9519\u8bef\u7684\uff01\u8fd9\u4e00\u95ee\u9898\u540c\u65f6\u4f1a\u53d1\u751f\u5728\u7b2c 3 \u6761\u6307\u4ee4\u90a3\u91cc\uff0c\u5b83\u5728\u7b2c 4 \u4e2a\u65f6\u949f\u5468\u671f\u9700\u8981\u7528\u5230  <code>x2</code>  \u7684\u503c\uff0c\u4f46\u662f\u8fd9\u65f6\u5019  <code>x2</code>  \u7684\u503c\u4ecd\u672a\u88ab\u66f4\u65b0\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u7531\u4e8e\u6307\u4ee4\u6240\u9700\u7684\u6570\u636e\u4f9d\u8d56\u4e8e\u524d\u9762\u4e00\u6761\u5c1a\u672a\u5b8c\u6210\u7684\u6307\u4ee4\uff0c\u56e0\u6b64\u6307\u4ee4\u4e0d\u80fd\u5728\u9884\u671f\u7684\u65f6\u949f\u5468\u671f\u5185\u6267\u884c\uff0c\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u79f0\u4e4b\u4e3a data hazard\u3002</p> Info <p>\u5728\u7b2c 5 \u4e2a\u65f6\u949f\u5468\u671f\u5185\uff0c\u5173\u4e8e Reg files \u6211\u4eec\u9700\u8981\u5b8c\u6210 2 \u4ef6\u4e8b\uff1a  <code>sub x2, x1, x3</code>  \u7684  <code>WB</code>  \u9636\u6bb5\u5c06  <code>x2</code>  \u7684\u65b0\u503c\u5199\u5165 Reg files\uff0c\u4ee5\u53ca  <code>add x14, x2, x2</code>  \u7684  <code>ID</code>  \u9636\u6bb5\u5c06  <code>x2</code>  \u7684\u503c\u8bfb\u51fa\u6765\u5e76\u4e14\u5b58\u5230  <code>ID/EX</code>  \u5bc4\u5b58\u5668\u4e2d\u3002\u8fd9\u4e24\u4e2a\u4e8b\u60c5\u6709\u6ca1\u6709\u53ef\u80fd\u6b63\u786e\u6267\u884c\u5462\uff1f\u7b54\u6848\u662f\u6709\u7684\uff01</p> <p>\u4f17\u6240\u5468\u77e5\uff0c\u65f6\u949f\u4fe1\u53f7\u6709\u4e0a\u5347\u6cbf\u548c\u4e0b\u964d\u6cbf\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u89c4\u5b9a\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u7531\u4e00\u4e2a\u4e0a\u5347\u6cbf\u5f00\u59cb\u5230\u53e6\u4e00\u4e2a\u4e0a\u5347\u6cbf\u7ed3\u675f\uff0c\u4e5f\u53ef\u4ee5\u89c4\u5b9a\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u4ece\u4e00\u4e2a\u4e0b\u964d\u6cbf\u5f00\u59cb\u5230\u53e6\u4e00\u4e2a\u4e0b\u964d\u6cbf\u7ed3\u675f\uff1a</p> <p></p> <p>\u5728\u8bfe\u672c\u7684\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u91c7\u53d6\u524d\u8005\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u5c31\u662f\u76f8\u90bb\u4e24\u6b21\u4e0a\u5347\u6cbf\u4e4b\u95f4\u7684\u65f6\u95f4\u6bb5\u3002</p> <p>\u800c\u5bc4\u5b58\u5668\u7684\u5199\u5165\u53ef\u4ee5\u7531\u4e0a\u5347\u6cbf\u89e6\u53d1\uff0c\u4e5f\u53ef\u4ee5\u7531\u4e0b\u964d\u6cbf\u89e6\u53d1\u3002\u5982\u679c\u6211\u4eec\u89c4\u5b9a Reg files \u4e2d\u7684\u5bc4\u5b58\u5668\u5728\u4e0a\u5347\u6cbf\u89e6\u53d1\u5199\u5165\uff0c\u4e5f\u5c31\u662f\u5728\u524d\u534a\u4e2a\u5468\u671f\u4e2d\u5b8c\u6210\u5199\u5165 Reg files \u5bc4\u5b58\u5668\u7684\u5de5\u4f5c\uff1b\u800c\u89c4\u5b9a Pipeline registers \u5728\u4e0b\u964d\u6cbf\u89e6\u53d1\u5199\u5165\uff0c\u4e5f\u5c31\u662f\u5728\u540e\u534a\u4e2a\u5468\u671f\u5b8c\u6210\u5199\u5165\u5de5\u4f5c\uff0c\u90a3\u4e48\uff0c\u5728\u7b2c 5 \u4e2a\u65f6\u949f\u5468\u671f\u7684\u4e0a\u534a\uff0c  <code>x2</code>  \u7684\u65b0\u503c\u88ab\u5199\u5165\uff1b\u4e0b\u534a\u8bfb\u51fa  <code>x2</code>  \u5e76\u5199\u5165  <code>ID/EX</code>  \u7684\u503c\u5c31\u662f  <code>x2</code>  \u7684\u65b0\u503c\u4e86\u3002\u6240\u4ee5\u8bf4\uff0c\u8fd9\u6837\u7684\u8bbe\u8ba1\u4f7f\u5f97\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u51fa\u73b0 data hazard\u3002</p> <p>\u8fd9\u4e5f\u5c31\u80fd\u89e3\u91ca\u4e3a\u4ec0\u4e48  <code>PC</code>  \u8981\u5728\u4e0b\u964d\u6cbf\u5199\u5165\u4e86\uff0c\u770b datapath \u7684\u8fd9\u4e00\u90e8\u5206\uff1a</p> <p></p> <p>\u5982\u679c  <code>PC</code>  \u5728\u4e0a\u5347\u6cbf\u5199\u5165\uff0c\u4e5f\u5c31\u662f\u5728\u4e0a\u5347\u6cbf\u66f4\u65b0\u5230\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48\u5728\u4e0b\u964d\u6cbf\u8981\u5c06\u5f53\u524d\u6307\u4ee4\u5199\u5165  <code>IF/ID</code>  \u7684\u65f6\u5019\uff0c\u4ece inst mem \u4e2d\u8bfb\u51fa\u7684\u6307\u4ee4\u5df2\u7ecf\u662f\u4e0b\u4e00\u6761\u800c\u4e0d\u662f\u5f53\u524d\u6307\u4ee4\u4e86\uff01\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u8ba9  <code>PC</code>  \u5728\u4e0b\u964d\u6cbf\u5199\u5165\uff0c\u8fd9\u6837\u624d\u80fd\u8bfb\u53d6\u5230\u6b63\u786e\u7684\u6307\u4ee4\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cReg files \u7684\u5199\u5165\u5747\u53d1\u751f\u5728\u4e0a\u534a\u5468\u671f\uff0c\u4e5f\u5c31\u662f\u4e0a\u5347\u6cbf\uff1b\u800c Pipeline registers \u548c  <code>PC</code>  \u7684\u5199\u5165\u5747\u53d1\u751f\u5728\u4e0b\u534a\u5468\u671f\uff0c\u4e5f\u5c31\u662f\u4e0b\u964d\u6cbf\u3002</p> <p>\u8fd9\u4e5f\u662f\u56fe\u4f8b\u4e2d reg file \u7528\u5de6\u534a\u8fb9\u4e3a\u6df1\u8272\u8868\u793a\u5199\u5165\uff0c\u53f3\u534a\u8fb9\u4e3a\u6df1\u8272\u8868\u793a\u8bfb\u53d6\u7684\u539f\u56e0\uff1a\u5199\u5165\u53d1\u751f\u5728\u4e0a\u534a\u4e2a\u5468\u671f\uff0c\u800c\u4f7f\u7528\u8bfb\u53d6\u7684\u7ed3\u679c\u53d1\u751f\u5728\u4e0b\u534a\u4e2a\u5468\u671f\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u4f55\u89e3\u51b3 data hazard \u5462\uff1f\u56de\u987e\u521a\u521a\u7684\u90a3\u5f20\u56fe\uff1a</p> <p></p> <p>\u6211\u4eec\u6ce8\u610f\u5230\uff0c\u867d\u7136  <code>sub x2, x1, x3</code>  \u5728\u7b2c 5 \u4e2a\u65f6\u949f\u5468\u671f\u7684  <code>WB</code>  \u9636\u6bb5\u624d\u5c06\u7ed3\u679c\u5199\u56de\uff0c\u4f46\u662f\u5728\u7b2c 3 \u4e2a\u65f6\u949f\u5468\u671f\u7684  <code>EX</code>  \u9636\u6bb5\u5176\u5b9e\u5c31\u7b97\u51fa\u6765\u4e86\uff01\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u589e\u52a0\u989d\u5916\u7684\u786c\u4ef6\u7ed3\u6784\uff0c\u4f7f\u5f97 ALU \u7684\u8f93\u5165\u4e0d\u4ec5\u53ef\u4ee5\u6765\u6e90\u4e8e\u5bc4\u5b58\u5668\u4e2d\u8bfb\u51fa\u6765\u7684\u3001\u653e\u5728  <code>ID/EX</code>  \u4e2d\u7684\u503c\uff0c\u8fd8\u53ef\u4ee5\u6765\u6e90\u4e8e  <code>EX/MEM</code>  \u4e2d\u6216\u8005  <code>MEM/WB</code>  \u4e2d\u7684\u503c\uff0c\u5b83\u4eec\u5206\u522b\u5bf9\u5e94\u524d\u4e00\u6761\u548c\u518d\u524d\u4e00\u6761\u6307\u4ee4\u7684 ALU \u7684\u8ba1\u7b97\u7ed3\u679c\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a </p> <p></p> <p>\u5728\u7b2c 3 \u4e2a\u65f6\u949f\u5468\u671f\uff0c\u7b2c\u4e00\u6761\u6307\u4ee4\u7684\u7ed3\u679c\u88ab\u7b97\u51fa\u5e76\u4fdd\u5b58\u5728  <code>EX/MEM</code> </p> <p>\u5b66\u4e0d\u5b8c\u4e86\uff0c\u6682\u65f6\u4e0d\u8be6\u7ec6\u5199\u4e86\uff0c\u5927\u610f\u5c31\u662f   <code>X = 1, 2 = if (MEM.Rd != x0 &amp;&amp; EX.RsX == MEM.Rd) ForwardX = 10; else if (WB.Rd != x0 &amp;&amp; EX.RsX == WB.Rd) ForwardX = 01; else ForwardX = 00;</code>  \uff1a</p> <p></p> <p>\u4f46\u662f\u9047\u5230 load \u6307\u4ee4\u4e0d\u5f97\u4e0d stall\uff1a</p> <p></p> <p></p> <p>\u5728 ID \u9636\u6bb5\u53ef\u4ee5\u5224\u5b9a hazard\uff1a  <code>if (EX.MemRead &amp;&amp; EX.Rd == ID.RsX) Hazard();</code> </p> <p>\u5982\u4f55 stall \u5462\uff1f\u4e24\u4e2a\u4efb\u52a1\uff1a\u8ba9\u5f53\u524d\u6307\u4ee4\u4e0d\u8981\u4ea7\u751f\u6548\u679c (\u6e05\u7a7a  <code>RegWrite</code>  \u548c  <code>MemWrite</code>  )\u3001\u8ba9\u540e\u9762\u7684\u8bed\u53e5\u4e0d\u8981\u53d7\u5230\u5f71\u54cd (\u4fdd\u7559  <code>PC</code>  \u548c  <code>IF/ID</code>  \u4e00\u5468\u671f\u4e0d\u6539)\uff1a</p> <p></p>"},{"location":"4-x/#424-control-hazards--branch-hazards","title":"4.2.4 Control Hazards / Branch Hazards","text":"<p>\u4f8b\u9898</p> <p>\u4e0b\u9762\u4e00\u6bb5\u4ee3\u7801\u5728\u4e0d\u8003\u8651\u89e3\u51b3 hazard \u7684\u60c5\u51b5\u4e0b\u7684\u8fd0\u884c\u7ed3\u679c\u662f\u4ec0\u4e48\uff1f\u5047\u8bbe\u6240\u6709\u5bc4\u5b58\u5668\u521d\u59cb\u503c\u4e3a 0\uff0cMem(1) = 0x99, Mem(8) = 0xaa, Mem(9) = 0xbb\u3002</p> <p></p> \u89e3\u7b54 <p>\u6211\u4eec\u53ef\u4ee5\u6a21\u62df\u6bcf\u6761\u6307\u4ee4\u5404\u9636\u6bb5\u7684\u6267\u884c\u60c5\u51b5\uff1a</p> <p></p> <p>\u4ece\u4e2d\u6211\u4eec\u4e5f\u53ef\u4ee5\u603b\u7ed3\u51fa\u89c4\u5f8b\uff08\u8fd9\u548c\u6d41\u6c34\u7ebf\u7684\u5177\u4f53\u8bbe\u8ba1\u6709\u5173\uff01\uff09\uff0c\u5373\uff1a</p> <ul> <li>\u67d0\u6761\u6307\u4ee4 (\u4f8b\u5982  <code>#10</code> )  <code>WB</code>  \u9636\u6bb5\u505a\u7684\u5bc4\u5b58\u5668\u66f4\u6539\uff0c\u5176\u4e4b\u540e\u7b2c\u4e09\u6761\u6307\u4ee4 ( <code>#13</code> ) \u7684  <code>ID</code>  \u9636\u6bb5\u624d\u80fd\u8bfb\u51fa\u65b0\u7684\u503c\uff1b</li> <li>\u67d0\u6761\u6307\u4ee4 (\u4f8b\u5982  <code>#10</code> )  <code>MEM</code>  \u9636\u6bb5\u4ea7\u751f  <code>PCSrc = 1</code>  \u7684\u4fe1\u53f7\uff0c\u6b64\u65f6\u5176\u4e4b\u540e\u7b2c\u4e09\u6761\u6307\u4ee4 ( <code>#13</code> ) \u6b63\u5728\u8fd0\u884c  <code>IF</code>  \u9636\u6bb5\uff0c\u5b83\u8fd0\u884c\u7ed3\u675f\u540e\u624d\u4f1a\u5c06  <code>PC</code>  \u7f6e\u4e3a\u5b9e\u9645\u4e0a\u8981\u8df3\u8f6c\u7684\u6307\u4ee4\uff0c\u56e0\u6b64\u5982\u679c\u8981\u8df3\u8f6c\u7684\u8bdd\uff0c <code>#11</code> ,  <code>#12</code> ,  <code>#13</code>  \u8fd9\u4e09\u6761\u8bed\u53e5\u662f\u989d\u5916\u8fd0\u884c\u7684\uff1b\u5982\u679c\u4e0d\u7528\u8df3\u8f6c\u5c31\u4ec0\u4e48\u4e8b\u90fd\u6ca1\u6709\u4e86\uff1b</li> <li>\u4e0d\u5b58\u5728\u5176\u4ed6\u5f71\u54cd\u7ed3\u679c\u7684\u60c5\u51b5\u4e86\uff01</li> </ul> <p>\u5229\u7528\u8fd9\u4e9b\u89c4\u5f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u7b80\u5316\u6211\u4eec\u7684\u89e3\u9898\u65b9\u5f0f\uff1a</p> <p>Reg: \u5230\u54ea\u4e00\u6b21\u6267\u884c\u7684 ID \u9636\u6bb5\u5f00\u59cb\uff0c\u8bfb\u51fa\u7684 Reg \u503c\u4f1a\u662f\u8be5\u503c PC: \u5230\u54ea\u4e00\u6b21\u6267\u884c \u4e4b\u540e\uff0cPC \u7684\u503c\u4f1a\u88ab\u6539\u4e3a\u8be5\u503c</p> <p></p>"},{"location":"4-x/#425-structural-hazard","title":"4.2.5 Structural Hazard","text":""},{"location":"4-x/#43-exceptions","title":"4.3 Exceptions","text":"<p>Exception \u548c Interrupt \u5728\u5f88\u591a\u5730\u65b9\u662f\u4e0d\u4f5c\u533a\u5206\u7684\uff0c\u4f46\u662f\u6211\u4eec\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u533a\u5206\uff1a</p> <p></p> <p>\u5f53 exception \u53d1\u751f\u65f6\uff0c\u5728 Supervisor Exception Program Counter, SEPC \u8fd9\u4e2a\u5bc4\u5b58\u5668\u4e2d\u4fdd\u5b58\u53d1\u751f exception \u7684\u6307\u4ee4\u5730\u5740\uff0c\u7136\u540e\u5c06\u63a7\u5236\u6743\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u3002\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u5fc5\u987b\u77e5\u9053\u53d1\u751f exception \u7684\u539f\u56e0\uff0cRISC-V \u4e2d\u4f7f\u7528\u7684\u65b9\u6cd5\u662f\u5728 Supervisor Exception Cause Register, SCAUSE \u8fd9\u4e2a\u5bc4\u5b58\u5668\u4e2d\u8bb0\u5f55 exception \u7684\u539f\u56e0\u3002\u53ef\u4ee5\u9009\u62e9\u7684\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f vectored interrupt\uff0c</p>"},{"location":"5-x/","title":"5 \u7f13\u5b58 | Cache","text":"<p> \u7ea6 6229 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 31 \u5206\u949f</p>"},{"location":"5-x/#51-memory-hierarchy-introduction","title":"5.1 Memory Hierarchy Introduction","text":"<p>\u4f17\u6240\u5468\u77e5\uff0c\u6307\u4ee4\u548c\u6570\u636e\u90fd\u9700\u8981\u5728 memory \u91cc\u624d\u80fd\u8bbf\u95ee\u3002\u800c\u8bbf\u95ee memory \u6bd4\u8f83\u6162\u3002</p> <p>\u5173\u6ce8\u5230\u7a0b\u5e8f\u5bf9 memory \u7684\u8bbf\u95ee\u6709\u5982\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>Temporal locality, \u65f6\u95f4\u5c40\u90e8\u6027\uff0c\u5373\u8fd1\u671f\u8bbf\u95ee\u7684\u9879\u76ee\u5f88\u6709\u53ef\u80fd\u4f1a\u5728\u77ed\u65f6\u95f4\u5185\u518d\u6b21\u88ab\u8bbf\u95ee\u3002\u4f8b\u5982\u5faa\u73af\u4e2d\u7684\u6307\u4ee4\u3001induction variables (\u5faa\u73af\u4e2d\u7528\u6765\u8ba1\u6570\u7684\u53d8\u91cf) \u7b49</li> <li>Spatial locality, \u7a7a\u95f4\u5c40\u90e8\u6027\uff0c\u5373\u8fd1\u671f\u8bbf\u95ee\u9879\u76ee\u9644\u8fd1\u7684\u9879\u76ee\u4e5f\u6709\u53ef\u80fd\u4f1a\u5728\u77ed\u65f6\u95f4\u5185\u518d\u6b21\u88ab\u8bbf\u95ee\u3002\u4f8b\u5982\u8fde\u7eed\u7684\u6307\u4ee4\u6267\u884c\uff0c\u6216\u8005\u6570\u7ec4\u53d8\u91cf\u7b49</li> </ul> <p>\u56e0\u6b64\uff0c\u7ed3\u6784\u5316\u7684 memory \u88ab\u8bbe\u8ba1\u51fa\u6765\u3002\u8fd1\u671f\u8bbf\u95ee\u5230\u7684\u5185\u5b58\u5355\u5143\u548c\u5b83\u9644\u8fd1\u7684\u5185\u5bb9\u88ab\u590d\u5236\u4e00\u4efd\u653e\u5728\u79bb CPU \u66f4\u8fd1\u3001\u8bbf\u95ee\u66f4\u5feb\uff0c\u4f46\u4e5f\u66f4\u5c0f\u7684 cache \u4e2d\uff0c\u4ece\u800c\u5229\u7528\u4e0a\u8ff0\u5c40\u90e8\u6027\u52a0\u901f\u8bbf\u95ee\u3002</p> <p></p> <p>\u6211\u4eec\u79f0\u590d\u5236\u7684\u5355\u4f4d\u662f block \u6216\u8005 line\uff0c\u5b83\u901a\u5e38\u662f 2 \u7684\u82e5\u5e72\u6b21\u65b9\u4e2a word \u90a3\u4e48\u5927\uff08\u4e00\u4e2a word \u662f 4 Byte\uff09\u3002</p> <p>\u5982\u679c\u6211\u4eec\u5e0c\u671b\u8bbf\u95ee\u7684\u5185\u5b58\u5355\u5143 (\u5373\uff0c\u5b83\u6240\u5728\u7684 block) \u6070\u597d\u5728 cache \u4e2d\uff08\u4e4b\u524d\u67d0\u4e00\u6b21\u88ab\u642c\u4e0a\u6765\u4e86\uff09\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u4e00\u6b21 hit\uff0c\u8fd9\u65f6\u6211\u4eec\u53ea\u9700\u8981\u4ece\u4e2d\u8bfb\u51fa\u6765\u5c31\u53ef\u4ee5\u4e86\u3002\u5224\u65ad\u662f\u5426 hit\uff0c\u4ee5\u53ca\u8bfb\u51fa\u6765\u7684\u65f6\u95f4\u79f0\u4e3a hit time\u3002</p> <p>\u5982\u679c\u5e76\u4e0d\u5b58\u5728\uff0c\u79f0\u4e3a\u4e00\u6b21 miss\u3002\u5f53 cache miss \u65f6\uff0c\u6211\u4eec\u9700\u8981\u5148\u5c06\u5185\u5bb9\u6240\u5728\u7684 block \u4ece memory \u62ff\u5230 cache\uff0c\u7136\u540e\u518d\u5c06\u5185\u5bb9\u8bfb\u5230\u5904\u7406\u5668\uff1b\u8fd9\u4e2a\u8fc7\u7a0b\u82b1\u7684\u65f6\u95f4\u6210\u4e3a miss penalty\u3002</p> <p>\u5bf9\u5e94\u7684\u6709 hit / miss rate (\u4e5f\u79f0 ratio) \u7684\u6982\u5ff5\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002</p>"},{"location":"5-x/#52-the-basics-of-cache","title":"5.2 The basics of Cache","text":"<p>\u4e0b\u9762\u6211\u4eec\u6765\u5177\u4f53\u8003\u8651 cache \u600e\u4e48\u5b9e\u73b0\u3002\u4e3b\u8981\u9700\u8981\u8ba8\u8bba\u7684\u95ee\u9898\u662f\uff1a\u5982\u4f55\u77e5\u9053\u4e00\u4e2a block \u662f\u5426\u5728 cache \u91cc\uff1f\u4ee5\u53ca\u5982\u679c\u77e5\u9053\u5b83\u5728\u7684\u8bdd\uff0c\u5982\u4f55\u627e\u5230\u5b83\uff1f</p>"},{"location":"5-x/#531-direct-mapped-cache","title":"5.3.1 Direct Mapped Cache","text":"<p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5185\u5b58\u6709 32 \u4e2a block\uff0c\u5176\u7f16\u53f7 (block address) \u5206\u522b\u4e3a 00000 \u5230 11111\uff1bcache \u6709 8 \u4e2a block\u3002Direct mapped cache \u8fd9\u79cd\u65b9\u5f0f\u76f4\u63a5\u6309 block address \u7684\u540e 3 \u4f4d\u786e\u5b9a\u5b83\u5e94\u8be5\u653e\u5728 cache \u7684\u54ea\u4e2a block \u91cc\u3002</p> <p>\u5373\uff0c\u56fe\u4e0a\u7070\u8272\u7684 block \u7684\u7f16\u53f7\u672b 3 \u4f4d\u90fd\u662f 001\uff0c\u6240\u4ee5\u5c31\u5e94\u8be5\u653e\u5728 cache \u4e2d\u7f16\u53f7\u4e3a 001 \u7684\u7070\u8272 block \u91cc\uff1b\u6a59\u8272\u540c\u7406\u3002</p> <p>\u4e3a\u4ec0\u4e48\u662f\u4e09\u4f4d\u5462\uff1f\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a cache \u6709 8 \u4e2a block \u7684\u8bdd\uff0c\u5176\u5bf9\u5e94\u7684\u5c31\u662f 3 \u4f4d\u4e8c\u8fdb\u5236\u6570\u3002\u6211\u4eec\u628a\u8fd9\u4e2a\u51b3\u5b9a\u6620\u5c04\u5173\u7cfb\u7684\u672b\u51e0\u4f4d\u79f0\u4e3a index\u3002\u540c\u7406\uff0c\u5982\u679c cache \u6709 64 \u4e2a block \u7684\u8bdd\uff0cindex \u5c31\u662f 6 \u4f4d\u3002Cache \u7684 block \u6570\u59cb\u7ec8\u662f 2 \u7684\u5e42\u6b21\u65b9\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u5982\u4f55\u786e\u5b9a\u653e\u5728 cache \u4e2d\u7f16\u53f7\u4e3a 001 \u7684\u4f4d\u7f6e\u7684 block \u7a76\u7adf\u662f 00001\uff0c\u8fd8\u662f 01001\uff0c\u8fd8\u662f\u5176\u4ed6\u7684\u54ea\u4e2a block \u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5728 cache \u4e2d\u989d\u5916\u5b58\u653e\u8fd9\u4e2a block \u7684 block address \u6765\u77e5\u9053\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u5f53\u7136\uff0c\u5b9e\u9645\u4e0a\u6211\u4eec\u53ea\u9700\u8981\u5b58\u653e\u8fd9\u4e2a block address \u7684\u524d\u82e5\u5e72\u4f4d\uff0c\u56e0\u4e3a\u540e\u9762\u7684\u51e0\u4f4d\u5df2\u7ecf\u901a\u8fc7 index \u6765\u786e\u5b9a\u4e86\u3002\u4f8b\u5982\u56fe\u4e0a\u7684\u4f8b\u5b50\u4e2d\uff0c10001 \u5b58\u5728 index \u4e3a 001 \u7684 cache block \u4e2d\uff0c\u53ea\u9700\u8981\u989d\u5916\u5b58\u5f00\u5934\u7684 10 \u5373\u53ef\u3002\u6211\u4eec\u628a\u7528\u6765\u5224\u5b9a\u67d0\u4e2a cache block \u4e2d\u5230\u5e95\u5b58\u7684\u662f\u54ea\u4e2a memory block \u7684\u8fd9\u51e0\u4f4d\u79f0\u4e3a tag\u3002</p> <p>\u4e0b\u4e00\u4e2a\u95ee\u9898\u662f\uff0c\u5982\u4f55\u786e\u5b9a cache \u4e2d\u7684\u8fd9\u4e2a block \u662f\u5426\u6709\u6548\u5462\uff1f\u4e5f\u5c31\u662f\u8bf4\uff0c\u4efb\u4f55\u65f6\u5019\u8fd9\u4e2a block \u4e2d\u603b\u6709\u4e00\u4e2a\u503c\uff0c\u4f46\u662f\u5047\u8bbe\u8fd9\u4e2a\u503c\u662f\u542f\u52a8\u7684\u65f6\u5019\u81ea\u5e26\u7684\uff0c\u90a3\u4e48\u8bbf\u95ee\u5b83\u5c31\u4f1a\u53d1\u751f\u9519\u8bef\uff0c\u56e0\u4e3a\u5b83\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u5bf9\u5e94\u7684 memory block \u7684\u503c\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5f15\u5165\u4e00\u4e2a valid bit \u6765\u8868\u793a\u8fd9\u4e2a block \u662f\u5426\u6709\u6548\uff1b\u521d\u59cb\u503c\u4e3a 0 \u8868\u793a\u65e0\u6548\uff0c\u5f53\u6709\u4e00\u6b21\u5c06 memory \u7684\u4e00\u4e2a block \u62ff\u8fdb\u6765\u4e4b\u540e\u5c31\u5c06\u5176\u7f6e\u4e3a 1\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0ccache hit \u5f53\u4e14\u4ec5\u5f53 valid bit \u662f 1 \u800c\u4e14 tag \u662f\u4e00\u81f4\u7684\u3002</p> <p>\u6211\u4eec\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u90fd\u662f\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u7684\uff0c\u800c\u4e0a\u9762\u6211\u4eec\u8ba8\u8bba\u7684 block address \u90fd\u662f\u4ee5 block \u4e3a\u5355\u4f4d\u7684\uff0c\u8fd9\u4e24\u8005\u4e4b\u95f4\u6709\u4ec0\u4e48\u6837\u7684\u5173\u7cfb\u5462\uff1f\u975e\u5e38\u7b80\u5355\uff0c\u7531\u4e8e\u4e00\u4e2a block \u603b\u662f 2 \u7684\u82e5\u5e72\u6b21\u65b9\u4e2a word \u90a3\u4e48\u5927\uff0c \u800c\u6bcf\u4e2a word \u662f 4 Byte\uff0c\u56e0\u6b64\u6bcf\u4e2a block \u7684 byte \u6570\u4e5f\u662f 2 \u7684\u82e5\u5e72\u6b21\u65b9\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ea\u9700\u8981\u53bb\u6389 byte address \u7684\u540e\u51e0\u4f4d\uff0c\u5c31\u53ef\u4ee5\u83b7\u5f97\u5b83\u7684 block address \u4e86\u3002\u8fd9\u6837\u76f8\u90bb\u7684 2 \u7684\u82e5\u5e72\u6b21\u65b9\u4e2a byte \u5c31\u4f1a\u805a\u5408\u6210\u4e00\u4e2a block \u4e86\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684 byte address \u7684\u524d\u82e5\u5e72\u4f4d\uff0c\u5373 block address\uff0c\u662f\u76f8\u540c\u7684\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u5c06 byte address \u5206\u4e3a 2 \u4e2a\u90e8\u5206\uff1ablock address \u548c byte offset\uff0c\u5373\u6240\u5728 block \u7684\u7f16\u53f7\u4ee5\u53ca\u5728 block \u4e2d\u7684\u504f\u79fb\u91cf (in byte)\uff1b\u800c block address \u53c8\u5206\u4e3a\u4e86\u4e24\u4e2a\u90e8\u5206\uff0c\u5373 tag \u548c index\u3002\u5373\uff1a</p> <p></p> <p>\u800c\u5728 cache \u4e2d\uff0c\u6211\u4eec\u5b58\u50a8\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> <p></p> <p>\u5373\uff0c\u6bcf\u4e2a cache block \u6709\u4e00\u4e2a index\uff0c\u5f53\u51fa\u73b0\u4e00\u6b21 miss \u540e\u4ece\u5185\u5b58\u4e2d\u62ff\u6240\u9700\u5185\u5b58\u8986\u76d6\u5230\u5bf9\u5e94\u7684 index \u6761\u76ee\u4e0a\u7684 data \u5b57\u6bb5\uff0c\u5c06 tag \u8bbe\u4e3a block address \u7684\u524d\u51e0\u4f4d\uff0c\u5c06 valid bit \u8bbe\u4e3a 1\u3002</p> \u4f8b 5.1 Direct Mapped Cache \u7684\u586b\u5145\u548c\u66ff\u6362 <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff1a</p> <p></p> \u4f8b 5.2 Direct Mapped Cache \u7684\u4f4d\u6570\u8ba1\u7b97\u548c\u8fde\u7ebf\u65b9\u5f0f <p>\u53c8\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a 64 \u4f4d\u5730\u5740\u7684\u673a\u5668\uff0ccache \u7684\u5927\u5c0f\u4e3a 1024 \u4e2a block\uff0c\u4e00\u4e2a block \u6709 1 \u4e2a word\uff0c\u5373 4 \u4e2a byte\uff0c\u90a3\u4e48 index \u7684\u4f4d\u6570\u5c31\u662f \\(\\log_2 1024 = 10\\)\uff0cbyte offset \u7684\u4f4d\u6570\u5c31\u662f \\(\\log_2 4 = 2\\)\uff0c\u56e0\u6b64 tag \u7684\u4f4d\u6570\u5c31\u662f \\(64 - 10 - 2 = 52\\)\uff1b\u53e6\u5916\u4e00\u4e2a block \u7684\u5927\u5c0f\u662f 4 \u4e2a byte\uff0c\u5373 32 \u4f4d\uff0c\u56e0\u6b64\u4e00\u4e2a cache \u7684\u6761\u76ee\u7684\u4f4d\u6570\u5c31\u662f valid bit 1 \u4f4d + tag 52 \u4f4d + word 32 \u4f4d = 85 \u4f4d\u3002</p> <p>\uff08index \u5e76\u4e0d\u9700\u8981\u5728\u8fd9\u91cc\u88ab\u8ba1\u7b97\uff0c\u56e0\u4e3a index \u4e4b\u4e8e cache \u5c31\u50cf address \u4e4b\u4e8e main memory \u4e00\u6837\uff0c\u662f\u76f4\u63a5\u7528\u6765\u8bbf\u95ee\u7684\uff09</p> <p>\u4ea6\u5373\uff1a</p> <p></p> <p>\u5f53\u7136\uff0c\u5982\u6211\u4eec\u4e4b\u524d\u6240\u8bf4\uff0c\u4e00\u4e2a block \u6709\u53ef\u80fd\u5305\u542b\u591a\u4e2a word\uff0c\u800c\u6bcf\u6b21\u5b9e\u9645\u4e0a\u53ea\u4f1a\u8bbf\u95ee\u51fa\u4e00\u4e2a word\u3002\u56e0\u6b64\u8fd9\u65f6\u6211\u4eec\u8fd8\u9700\u8981\u5728 block \u4e2d\u9009\u62e9\u5bf9\u5e94\u7684 word\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06 byte offset \u8fdb\u4e00\u6b65\u7ec6\u5206\u6210\u8868\u793a block \u4e2d\u67d0\u4e2a word \u7684 block offset\uff08\u4e3a\u4ec0\u4e48\u4e0d\u53eb word offset \u5462\uff1f\uff09\uff0c\u4ee5\u53ca\u8868\u793a word \u4e2d\u67d0\u4e2a byte \u7684 byte offset\uff1a</p> <p></p> <p>\u5373\uff0c\u5bf9\u8fd9\u4e2a\u56fe\u4e2d\u7684\u60c5\u5f62\uff0c\u5730\u5740\u662f 32 \u4f4d\u7684\uff0c\u4e00\u4e2a block \u6709 16 \u4e2a word\uff0c\u6709 256 \u4e2a cache entry\u3002\u56e0\u6b64 byte offset \u7684\u4f4d\u6570\u662f \\(\\log_2 4 = 2\\)\uff0cblock offset \u7684\u4f4d\u6570\u662f \\(\\log_2 16 = 4\\)\uff0cindex \u7684\u4f4d\u6570\u662f \\(\\log_2 256 = 8\\)\uff0ctag \u7684\u4f4d\u6570\u662f \\(32-8-4-2=18\\)\uff0c\u4e00\u4e2a cache entry \u7684\u957f\u5ea6\u662f valid bit 1 \u4f4d + tag 18 \u4f4d + data 16 word * 4 byte/word * 8 bit/byte = 531 \u4f4d\u3002</p> \u4f8b 5.3 Direct Mapped Cache \u7684\u4f4d\u6570\u8ba1\u7b97 <p>\u518d\u4f8b\u5982\uff1a</p> <p></p>"},{"location":"5-x/#532-handling-cache-hits--misses","title":"5.3.2 Handling Cache Hits &amp; Misses","text":"<p>\u663e\u7136\uff0c\u8bfb\u548c\u5199\u7684\u65f6\u5019\u53d1\u751f cache miss \u7684\u5904\u7406\u65b9\u5f0f\u662f\u4e0d\u4e00\u6837\u7684\uff1b\u53e6\u5916\u8bfb\u4e5f\u6709\u8bfb\u6570\u636e\u548c\u8bfb\u6307\u4ee4\u4e4b\u5206\uff08\u6307\u4ee4 cache \u548c\u6570\u636e cache \u901a\u5e38\u662f\u5206\u79bb\u7684\uff09\u3002\u6211\u4eec\u5206\u522b\u5bf9\u5176\u8fdb\u884c\u8ba8\u8bba\uff1a</p> <ul> <li>Read<ul> <li>Hit<ul> <li>\u76f4\u63a5\u4ece cache \u91cc\u8bfb\u5c31\u597d\u4e86</li> </ul> </li> <li>Miss<ul> <li>Data cache miss<ul> <li>\u4ece memory \u91cc\u628a\u5bf9\u5e94\u7684 block \u62ff\u5230 cache\uff0c\u7136\u540e\u8bfb\u53d6\u5bf9\u5e94\u7684\u5185\u5bb9\u3002</li> </ul> </li> <li>Instruction cache miss<ul> <li>\u6682\u505c CPU \u8fd0\u884c\uff0c\u4ece memory \u91cc\u628a\u5bf9\u5e94\u7684 block \u62ff\u5230 cache\uff0c\u4ece\u7b2c\u4e00\u4e2a step \u5f00\u59cb\u91cd\u65b0\u8fd0\u884c\u5f53\u524d\u8fd9\u6761\u6307\u4ee4\u3002</li> </ul> </li> </ul> </li> </ul> </li> <li>Write<ul> <li>Hit \u6709\u4e24\u79cd\u53ef\u4ee5\u9009\u7684\u65b9\u5f0f\uff1a<ul> <li>write-through\uff0c\u5373\u6bcf\u6b21\u5199\u6570\u636e\u65f6\uff0c\u65e2\u5199\u5728 cache\uff0c\u4e5f\u5199\u5728 main memory\u3002\u8fd9\u6837\u7684\u597d\u5904\u662f cache \u548c main memory \u603b\u662f\u4e00\u81f4\u7684\uff0c\u4f46\u662f\u8fd9\u6837\u5f88\u6162\u3002<ul> <li>\u4e00\u4e2a\u6539\u8fdb\u662f\u5f15\u5165\u4e00\u4e2a write buffer\uff0c\u5373\u5f53\u9700\u8981\u5199 main memory \u7684\u65f6\u5019\u4e0d\u662f\u7acb\u5373\u53bb\u5199\uff0c\u800c\u662f\u52a0\u5165\u5230\u8fd9\u4e2a\u961f\u5217\u4e2d\uff0c\u627e\u673a\u4f1a\u5199\u8fdb\u53bb\uff1b\u6b64\u65f6 CPU \u5c31\u53ef\u4ee5\u7ee7\u7eed\u8fd0\u884c\u4e86\u3002\u5f53\u7136\uff0c\u5f53 write buffer \u6ee1\u4e86\u7684\u65f6\u5019\uff0c\u4e5f\u9700\u8981\u6682\u505c\u5904\u7406\u5668\u6765\u505a\u5199\u5165 main memory \u7684\u5de5\u4f5c\uff0c\u76f4\u5230 buffer \u4e2d\u6709\u7a7a\u95f2\u7684 entry\u3002\u56e0\u6b64\uff0c\u5982\u679c main memory \u7684\u5199\u5165\u901f\u7387\u4f4e\u4e8e CPU \u4ea7\u751f\u5199\u64cd\u4f5c\u7684\u901f\u7387\uff0c\u591a\u5927\u7684\u7f13\u51b2\u90fd\u65e0\u6d4e\u4e8e\u4e8b\u3002</li> </ul> </li> <li>write-back\uff0c\u53ea\u5c06\u4fee\u6539\u7684\u5185\u5bb9\u5199\u5728 cache \u91cc\uff0c\u7b49\u5230\u8fd9\u4e2a block \u8981\u88ab\u8986\u76d6\u6389\u7684\u65f6\u5019\u5c06\u5176\u5199\u56de\u5185\u5b58\u3002\u8fd9\u79cd\u60c5\u51b5\u9700\u8981\u4e00\u4e2a\u989d\u5916\u7684 dirty bit \u6765\u8bb0\u5f55\u8fd9\u4e2a cache block \u662f\u5426\u88ab\u66f4\u6539\u8fc7\uff0c\u4ece\u800c\u76f4\u5230\u88ab\u8986\u76d6\u524d\u662f\u5426\u9700\u8981\u88ab\u5199\u56de\u5185\u5b58\u3002\u7531\u4e8e\u5bf9\u540c\u4e00\u4e2a block \u901a\u5e38\u4f1a\u6709\u591a\u6b21\u5199\u5165\uff0c\u56e0\u6b64\u8fd9\u79cd\u65b9\u5f0f\u6d88\u8017\u7684\u603b\u5e26\u5bbd\u662f\u66f4\u5c0f\u7684\u3002</li> </ul> </li> <li>Miss \u540c\u6837\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a<ul> <li>write allocate\uff0c\u5373\u50cf read miss \u4e00\u6837\u5148\u628a block \u62ff\u5230 cache \u91cc\u518d\u5199\u5165\u3002</li> <li>write around (or no write allocate)\uff0c\u8003\u8651\u5230\u65e2\u7136\u672c\u6765\u5c31\u8981\u53bb\u4e00\u6b21 main memory\uff0c\u4e0d\u5982\u76f4\u63a5\u5728\u91cc\u9762\u5199\u4e86\uff0c\u5c31\u4e0d\u518d\u62ff\u5230 cache \u91cc\u4e86\u3002</li> <li>write-back \u53ea\u80fd\u4f7f\u7528 write allocate\uff1b\u4e00\u822c\u6765\u8bf4\uff0cwrite-through \u4f7f\u7528 write around\uff0c\u5176\u539f\u56e0\u662f\u660e\u663e\u7684\u3002</li> </ul> </li> </ul> </li> </ul>"},{"location":"5-x/#533-\u5176\u4ed6\u5b9a\u4f4d\u65b9\u5f0f","title":"5.3.3 \u5176\u4ed6\u5b9a\u4f4d\u65b9\u5f0f","text":"<p>\u5728 5.3.1 \u4e2d\uff0c\u6211\u4eec\u8ba8\u8bba\u4e86\u6700\u7b80\u5355\u7684\u6620\u5c04\u65b9\u5f0f\uff0c\u5373\u76f4\u63a5\u6620\u5c04\uff1a\u5bf9\u4e8e\u4efb\u4e00\u7ed9\u5b9a\u7684 block address\uff0c\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a cache block \u53ef\u4f9b\u5b83\u5b58\u653e\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7684\u6620\u5c04\u65b9\u5f0f\u3002</p> <p>Fully associative\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662f block can go anywhere in cache\u3002\u8fd9\u79cd\u65b9\u5f0f\u7684\u597d\u5904\u662f\u53ef\u4ee5\u964d\u4f4e miss rate\uff0c\u574f\u5904\u662f\u6bcf\u6b21\u9700\u8981\u8ddf\u6240\u6709 block \u6bd4\u8f83\u662f\u5426 hit\uff1a</p> <p></p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u989d\u5916\u8ba8\u8bba\u66ff\u6362\u65f6\u91c7\u7528\u4ec0\u4e48\u6837\u7684\u7b56\u7565\uff1b\u5373\uff1a\u66ff\u6362\u54ea\u4e00\u5757\u3002\u901a\u5e38\u6709\u4e09\u79cd\u7b56\u7565\uff1a</p> <ul> <li>Random replacement\uff0c\u968f\u673a\u6311\u9009\u4e00\u4e2a\u5e78\u8fd0 block \u8986\u76d6\u6389\uff08\u9700\u8981\u4e00\u4e2a\u968f\u673a\u6570\u751f\u6210\u5668\uff09</li> <li>LRU, Least Recently Used\uff0c\u9009\u62e9\u4e0a\u4e00\u6b21\u4f7f\u7528\u65f6\u95f4\u8ddd\u79bb\u73b0\u5728\u6700\u8fdc\u7684\u90a3\u4e2a block \u8986\u76d6\u6389\uff08\u9700\u8981\u4e00\u4e9b\u989d\u5916\u7684\u4f4d\u7528\u6765\u8bb0\u5f55\u4fe1\u606f\uff0c\u5177\u4f53\u5b9e\u73b0\u6ca1\u6709\u8bb2\uff09</li> <li>FIFO, First In First Out\uff0c\u9009\u62e9\u8fdb\u5165\u65f6\u95f4\u6700\u65e9\u7684 block \u8986\u76d6\u6389\uff08\u540c\u6837\u9700\u8981\u4e00\u4e9b\u989d\u5916\u7684\u4f4d\u8bb0\u5f55\u4fe1\u606f\uff0c\u540c\u6837\u6ca1\u8bb2\u5177\u4f53\u5b9e\u73b0\uff09</li> </ul> <p>\u4ecb\u4e8e direct mapping \u548c fully associative \u4e4b\u95f4\u7684\u662f set associative\uff0c\u5373\u6bcf\u4e2a block \u4ecd\u7136\u4f1a\u6839\u636e\u5176 address \u786e\u5b9a\u5176\u53ef\u4ee5\u5b58\u653e\u7684 cache block\uff0c\u4f46\u662f\u53ef\u4ee5\u653e\u7684\u5730\u65b9\u5e76\u4e0d\u662f\u4e00\u4e2a\uff0c\u800c\u662f\u4e00\u7ec4\u3002\u5373\uff1a</p> <p></p> <p>\u6700\u53f3\u8fb9\u662f\u4e00\u4e2a 2-way set-associative \u7684\u4f8b\u5b50\uff0c\u6bcf\u4e2a\u5730\u5740\u5bf9\u5e94 cache \u4e2d\u7684\u4e00\u7ec4\uff0c\u5728\u8fd9\u91cc\u4e00\u7ec4\u6709\u4e24\u4e2a cache block\u3002\u56e0\u6b64\u5728\u8bbf\u95ee\u65f6\u4e5f\u9700\u8981\u5206\u522b\u6bd4\u8f83\u8fd9\u4e24\u4e2a block \u662f\u5426 hit\u3002\u5728\u66ff\u6362\u65f6\u4e5f\u9700\u8981\u51b3\u5b9a\u66ff\u6362\u54ea\u4e00\u5757\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u524d\u8ff0\u7684\u4e09\u4e2a\u7b56\u7565\u4e2d\u7684\u4e00\u4e2a\u5b9e\u73b0\u3002</p> <p>\u76f8\u4f3c\u5730\uff0c\u4e00\u4e2a 4-way set-associative \u7684\u8bbf\u95ee\u4e2d\u5224\u65ad hit \u548c\u83b7\u53d6 data \u7684\u8fde\u7ebf\u5982\u4e0b\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u4e8b\u5b9e\u4e0a\uff0cdirect mapping \u548c fully associative \u5176\u5b9e\u90fd\u662f set associative \u7684\u7279\u4f8b\uff1adirect mapping \u5176\u5b9e\u5c31\u662f 1-way set associative\uff0c\u800c fully associative \u5c31\u662f n-way set associative\uff0c\u5176\u4e2d n \u662f cache block \u7684\u4e2a\u6570\uff1b\u6211\u4eec\u79f0\u4e00\u7ec4\u7684\u5927\u5c0f\u4e3a associativity\uff0c\u90a3\u4e48\u8fd9\u4e24\u79cd\u65b9\u6cd5\u7684 associativity \u5c31\u5206\u522b\u662f 1 \u548c n\u3002</p> <p>\u663e\u7136\uff0c\u5728\u67e5\u770b\u6240\u9700 block \u662f\u5426\u5728 cache \u4e2d\u65f6\uff0c\u9700\u8981\u8bbf\u95ee\u7684 cache block \u4e2a\u6570\u5c31\u7b49\u4e8e associativity\uff0c\u5373\uff1a</p> <p></p> \u4f8b 5.4 Set associative \u7684\u4f4d\u6570\u8ba1\u7b97 <p>\u5df2\u77e5 Cache size is 4K Block, Block size is 4 words, Physical address is 32bits\uff0c\u6c42 direct-mapped, 2-way associative, 4-way associative, fully associative \u65f6 tag \u548c index \u7684\u4f4d\u6570\u3002</p> <p>\u5373\u6c42 associativity \u4e3a 1, 2, 4 \u548c 4096 \u65f6 tag \u548c index \u7684\u4f4d\u6570\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u5728 direct-mapped \u4e2d index \u662f\u7528\u6765\u786e\u5b9a memory block \u653e\u5728\u54ea\u4e2a cache block \u4e2d\u7684\uff0c\u90a3\u4e48\u5728 set-associative \u4e2d\uff0cindex \u5c31\u662f\u7528\u6765\u786e\u5b9a\u653e\u5728\u54ea\u4e2a set \u4e2d\u7684\u3002\u56e0\u6b64\uff0cindex \u7684\u4f4d\u6570\u5c31\u5bf9\u5e94\u7740 set \u7684\u4e2a\u6570\uff0c\u5373\uff1a</p> \\[\\text{index}_\\# = \\log_2(\\text{set}_\\#) = \\log_2\\frac{\\text{cache block}_\\#}{\\text{associativity}}\\] <p>\u56e0\u6b64 associativity \u4e3a 1, 2, 4, 4096 \u65f6\uff0cindex \u7684\u4f4d\u6570\u5206\u522b\u662f 12, 11, 10, 0\u3002</p> <p>\u7531\u4e8e block size \u4e3a 4 words\uff0c\u5373 16 Bytes\uff0c\u56e0\u6b64 byte offset \u9700\u8981 4 \u4f4d\uff08\u6216\u8005\uff0c\u5177\u4f53\u5730\u8bf4\uff0cblock offset 2 \u4f4d\uff0cbyte offset 2 \u4f4d\uff09\u3002\u6240\u4ee5\u5269\u4e0b\u7684\u90fd\u662f tag \u4e86\uff0c\u56e0\u6b64 tag \u7684\u4f4d\u6570\u5206\u522b\u662f 16, 17, 18, 28\u3002</p> 18 - 19 Final <p></p> <p></p> \u7b54\u6848 <p></p>"},{"location":"5-x/#53-measuring-cache-performance","title":"5.3 Measuring Cache Performance","text":"<p>\u518d\u8bf4\u5427</p>"},{"location":"5-x/#54-virtual-machines","title":"5.4 Virtual Machines","text":"<p>\u5148\u4e0d\u5b66\u4e86</p>"},{"location":"5-x/#55-virtual-memory","title":"5.5 Virtual Memory","text":""},{"location":"5-x/#551-\u865a\u62df\u5185\u5b58\u6280\u672f","title":"5.5.1 \u865a\u62df\u5185\u5b58\u6280\u672f","text":"<p>\u8ba1\u7ec4\u628a main memory \u63cf\u8ff0\u4e3a secondary storage (\u5373 disk) \u7684 \"cache\"\u3002\u6216\u8005\uff0c\u53cd\u8fc7\u6765\u8bf4\uff0c\u6211\u4eec\u628a\u90a3\u4e9b\u5728 main memory \u91cc\u653e\u4e0d\u4e0b\u7684\u5185\u5bb9\u5b58\u5230 disk \u91cc\uff08\u8fd9\u6837\u66f4\u80fd\u7b26\u5408\u6211\u4eec\u719f\u6089\u7684\u201c\u53ef\u6267\u884c\u6587\u4ef6\u5fc5\u987b\u52a0\u8f7d\u5230\u5185\u5b58\u624d\u80fd\u8fd0\u884c\u201d\u7684\u4e00\u8d2f\u8ba4\u77e5\uff09\u3002\u8fd9\u79cd\u6280\u672f\u79f0\u4e3a virtual memory\u3002</p> <p>\u865a\u62df\u5185\u5b58\u6280\u672f\u53ef\u4ee5\u8ba9\u591a\u4e2a\u7a0b\u5e8f\u4e4b\u95f4\u9ad8\u6548\u3001\u5b89\u5168\u5730\u5171\u4eab\u5185\u5b58\uff0c\u540c\u65f6\u5141\u8bb8\u5355\u4e2a\u7a0b\u5e8f\u4f7f\u7528\u8d85\u8fc7\u5185\u5b58\u5bb9\u91cf\u7684\u5185\u5b58\uff08\u6b63\u5982\u867d\u7136 CPU \u53d6\u6570\u636e\u65f6\u662f\u4ece cache \u4e2d\u53d6\u7684\uff0c\u4f46\u662f\u5b83\u80fd\u8bbf\u95ee\u5230\u7684\u6570\u636e\u7684\u6570\u76ee\u6bd4 cache \u7684\u5bb9\u91cf\u8981\u5927\uff09\u3002\u5728\u8fdc\u53e4\u65f6\u671f\uff0c\u5f88\u591a\u7a0b\u5e8f\u56e0\u4e3a\u9700\u8981\u4f7f\u7528\u8fc7\u5927\u7684\u5185\u5b58\u800c\u65e0\u6cd5\u88ab\u8fd0\u884c\uff1b\u4f46\u73b0\u5728\u7531\u4e8e\u865a\u62df\u5185\u5b58\u6280\u672f\u7684\u5e7f\u6cdb\u4f7f\u7528\uff0c\u8fd9\u4e9b\u7a0b\u5e8f\u90fd\u4e0d\u6210\u95ee\u9898\u4e86\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5b9e\u9645\u4e0a\u7684 main memory\uff08\u6211\u4eec\u79f0\u4e4b\u4e3a \u7269\u7406\u5185\u5b58, physical memory\uff09\u4e2d\u7684\u5730\u5740\u79f0\u4e3a \u7269\u7406\u5730\u5740, physical addresses\uff1b\u800c\u6211\u4eec\u7ed9\u6bcf\u4e00\u4e2a\u7a0b\u5e8f\u5185\u90e8\u4f7f\u7528\u5230\u7684\u5185\u5b58\u53e6\u5916\u7f16\u4e00\u5957\u5730\u5740\uff0c\u79f0\u4e3a \u865a\u62df\u5730\u5740, virtual addresses\uff1b\u865a\u62df\u5185\u5b58\u6280\u672f\u8d1f\u8d23\u4e86\u8fd9\u4e24\u4e2a\u5730\u5740\u4e4b\u95f4\u7684\u8f6c\u6362 (address translation\uff0c\u6211\u4eec\u7a0d\u540e\u518d\u8ba8\u8bba\u8f6c\u6362\u7684\u65b9\u5f0f)\uff1a</p> <p></p> <p>\u4ece\u8fd9\u5f20\u56fe\u4e2d\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u770b\u51fa\u201c\u865a\u62df\u5185\u5b58\u6280\u672f\u53ef\u4ee5\u5141\u8bb8\u5355\u4e2a\u7a0b\u5e8f\u8bbf\u95ee\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u5927\u5c0f\u9650\u5236\u7684\u5185\u5b58\u201d\u7684\u539f\u56e0\uff0c\u5373\u6709\u4e00\u4e9b\u5185\u5b58\u53ef\u4ee5\u88ab\u4e34\u65f6\u5730\u5b58\u653e\u5728\u78c1\u76d8\u4e0a\uff0c\u5230\u88ab\u8bbf\u95ee\u7684\u65f6\u5019\u518d\u88ab\u653e\u5230 physical memory \u4e2d\uff0c\u5c31\u50cf cache \u505a\u7684\u90a3\u6837\u3002</p> <p>\u4ece\u8fd9\u5f20\u56fe\u4e2d\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6ce8\u610f\u5230 physical memory \u7684\u5b58\u653e\u5e76\u6ca1\u6709\u5206\u7ec4\u7684\u6982\u5ff5\uff0c\u5373\u7528 cache \u7684\u672f\u8bed\u6765\u8bf4\uff0cmain memory \u662f fully-associative \u7684\u3002</p> <p>\u865a\u62df\u5b58\u50a8\u7684\u6280\u672f\u548c cache \u7684\u539f\u7406\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u4e00\u4e9b\u672f\u8bed\u7684\u540d\u5b57\u5e76\u4e0d\u76f8\u540c\u3002\u5bf9\u5e94\u4e8e cache \u4e2d\u7684 block / line\uff0c\u865a\u62df\u5b58\u50a8\u7684\u5185\u5b58\u5355\u5143\u79f0\u4e3a page\uff0c\u5f53\u6211\u4eec\u8981\u8bbf\u95ee\u7684 page \u4e0d\u5728\u4e3b\u5b58\u4e2d\u800c\u662f\u5728\u78c1\u76d8\u91cc\uff0c\u4e5f\u5c31\u662f miss\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u4e00\u6b21 page fault\u3002</p> Info <p>\u5728\u4e00\u4e9b\u5730\u65b9\uff0cvirtual page \u79f0\u4e3a page\uff0cphysical page \u79f0\u4e3a \u5e27, frame\uff1b\u6211\u4eec\u7684\u8bfe\u672c\u5e76\u672a\u91c7\u7528\u8fd9\u79cd\u79f0\u547c\u3002\u4f46\u65e0\u8bba\u5982\u4f55\uff0c\u5728\u770b\u5230\u5355\u72ec\u51fa\u73b0\u7684 page \u65f6\uff0c\u5e94\u5f53\u53c2\u8003\u4e0a\u4e0b\u6587\u5224\u65ad\u5b83\u662f virtual \u8fd8\u662f physical\u3002</p> <p>\u5728\u4e00\u4e9b\u5730\u65b9\uff0cvirtual address \u4e5f\u88ab\u79f0\u4e3a logical address\u3002</p>"},{"location":"5-x/#552-\u5982\u4f55\u5b8c\u6210\u6620\u5c04\u5462","title":"5.5.2 \u5982\u4f55\u5b8c\u6210\u6620\u5c04\u5462","text":"<p>\u9996\u5148\u6211\u4eec\u8981\u8003\u8651\u7684\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\uff0c\u4e00\u4e2a page \u5e94\u8be5\u6709\u591a\u5927\u3002\u6211\u4eec\u77e5\u9053\uff0c\u8bbf\u95ee\u78c1\u76d8\u76f8\u6bd4\u4e8e\u8bbf\u95ee\u5185\u5b58\u662f\u975e\u5e38\u6162\u7684\uff08\u76f8\u5dee\u5927\u7ea6\u5341\u4e07\u500d\uff09\uff0c\u8fd9\u4e2a\u4e3b\u8981\u65f6\u5ef6\u6765\u81ea\u4e8e\u78c1\u76d8\u8f6c\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u4e0a\u7684\u65f6\u95f4\u82b1\u8d39\uff1b\u6240\u4ee5\u6211\u4eec\u5e0c\u671b\u4e00\u6b21\u8bfb\u8fdb\u6765\u591a\u4e00\u70b9\u4ece\u800c\u6765\u5206\u644a\u8fd9\u4e2a\u8bbf\u95ee\u65f6\u95f4\u3002\u5178\u578b\u7684 page \u5927\u5c0f\u4ece 4KiB ~ 64KiB \u4e0d\u7b49\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u8003\u8651\u6620\u5c04\u5173\u7cfb\u3002\u6211\u4eec\u4e0d\u59a8\u5047\u8bbe\u4e00\u4e2a page \u7684\u5927\u5c0f\u662f 4KiB\uff0c\u90a3\u4e48\u5176\u9875\u5185\u7684\u504f\u79fb page offset \u5c31\u9700\u8981 12 \u4f4d\u6765\u8868\u793a\uff1b\u90a3\u4e48\u7269\u7406\u5730\u5740\u4e2d\u9664\u53bb\u540e 12 \u4f4d\u4ee5\u5916\u524d\u9762\u7684\u90e8\u5206\u5c31\u8868\u5f81\u7740\u5b83\u662f\u5c5e\u4e8e\u54ea\u4e00\u9875\u7684\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a physical page number\u3002</p> Info <p>\u5982\u6211\u4eec\u4e4b\u524d\u6240\u8bf4\uff0cmemory \u4f5c\u4e3a disk \u7684 \"cache\" \u662f fully-associative \u7684\uff0c\u56e0\u6b64 physical page number \u5176\u5b9e\u5c31\u662f cache \u4e2d\u7684 \"tag\"\uff0c\u800c page offset \u5c31\u662f cache \u4e2d\u7684 \"byte offset\"\uff0cfully-associative \u7684 cache \u5e76\u6ca1\u6709 index \u8fd9\u4e00\u5b57\u6bb5\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 fully-associative \u7684\u5b58\u50a8\u65b9\u5f0f\u5462\uff1f\u6211\u4eec\u5728 cache \u4e2d\u8ba8\u8bba\u8fc7\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7684\u597d\u5904\u662f\u5931\u6548\u7387\u4f4e\uff0c\u574f\u5904\u662f\u67e5\u8be2\u96be\u5ea6\u5927\u3002\u4f46\u662f\u6211\u4eec\u4e5f\u8ba8\u8bba\u5230\u4e86\uff0cpage fault \u7684\u5f00\u9500\u662f\u975e\u5e38\u5927\u7684\uff0c\u56e0\u6b64\u6bd4\u8f83\u4f4e\u7684 page fault \u7684\u6982\u7387\u76f8\u5bf9\u4e8e\u989d\u5916\u7684\u67e5\u8be2\u6765\u8bf4\u662f\u975e\u5e38\u5212\u7b97\u7684\u3002</p> <p>\u540c\u6837\uff0c\u7531\u4e8e\u8bfb\u5199\u78c1\u76d8\u662f\u975e\u5e38\u6162\u7684\uff0cwrite through \u7684\u7b56\u7565\u5e76\u4e0d\u5408\u9002\uff0c\u56e0\u6b64\u5728 virtual memory \u7684\u6280\u672f\u4e2d\uff0c\u6211\u4eec\u91c7\u53d6 write back \u7684\u65b9\u5f0f\u3002</p> <p>\u800c virtual address \u7684\u5f62\u5f0f\u4e0e\u4e4b\u7c7b\u4f3c\uff0c\u7531\u82e5\u5e72\u4f4d page number \u548c\u82e5\u5e72\u4f4d page offset \u7ec4\u6210\u3002</p> <p>\u6211\u4eec\u4e4b\u524d\u63d0\u5230\uff0c\u6211\u4eec\u6709\u4e00\u79cd\u65b9\u5f0f\u53ef\u4ee5\u627e\u5230 virtual page \u5bf9\u5e94\u7684 physical page\uff0c\u56e0\u6b64\u5f53\u6211\u4eec\u8981\u8bbf\u95ee\u4e00\u4e2a\u865a\u62df\u5730\u5740\u65f6\uff0c\u5c06\u5176 virtual page number \u901a\u8fc7\u8fd9\u79cd translation \u8f6c\u6362\u4e3a physical page number\uff08\u8fd9\u79cd translation \u4e5f\u4f1a\u8d1f\u8d23 page fault \u7684\u5904\u7406\u5e76\u7ed9\u51fa\u6b63\u786e\u7684\u8f6c\u6362\uff09\uff0c\u800c page offset \u8868\u793a\u7684\u662f\u5728\u4e00\u9875\u5185\u7684\u504f\u79fb\uff0c\u4fdd\u6301\u4e0d\u53d8\u5373\u53ef\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u83b7\u5f97\u4e86\u8fd9\u4e2a virtual address \u5bf9\u5e94\u7684 physical address\uff0c\u4e5f\u5c31\u662f\u5b83\u5728\u5b9e\u9645\u7684 main memory \u4e2d\u5b58\u50a8\u7684\u4f4d\u7f6e\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u540c\u65f6\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0cvirtual page number \u7684\u4f4d\u6570\u6bd4 physical \u7684\u591a\uff1b\u8fd9\u4e5f\u662f\u663e\u7136\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5f15\u5165\u865a\u62df\u5185\u5b58\u7684\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u5c31\u662f\u4e3a\u4e86\u4f7f\u7528\u6bd4 main memory \u66f4\u5927\u7684\u5185\u5b58\u3002</p> Info <p>\u5982\u679c\u6211\u4eec\u628a translation \u770b\u6210\u4e00\u4e2a\u51fd\u6570\uff08\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u4e4b\u540e\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u79cd translation \u786e\u5b9e\u7b26\u5408\u51fd\u6570\u7684\u5b9a\u4e49\uff09\uff0c\u90a3\u4e48\u4e8b\u5b9e\u4e0a virtual page number \u5230 physical page number \u7684\u8f6c\u6362\u662f direct mapped \u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u4ece\u4e00\u4e2a virtual page number \u53ef\u4ee5\u786e\u5207\u5730\u627e\u5230 \u4e00\u4e2a physical page number\uff0c\u800c\u4e0d\u662f\u5728\u4e00\u7ec4\u4e2d\u518d\u53bb\u5bfb\u627e\u3002\u56e0\u6b64\uff0cvirtual page number \u5b9e\u9645\u4e0a\u5bf9\u5e94\u4e86 cache \u4e2d\u7684 \"index\"\uff0ctag \u5e76\u4e0d\u9700\u8981\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0c\u6211\u4eec\u8ba4\u4e3a virtual address \u4e4b\u4e8e physical address \u662f direct mapped \u7684\uff0cvirtual page number \u5bf9\u5e94 cache \u4e2d\u7684 index\uff0cpage offset \u5bf9\u5e94 byte offset\uff1b\u800c physical address \u4e4b\u4e8e secondary storage \u662f fully associative \u7684\uff0cphysical page number \u5bf9\u5e94 cache \u4e2d\u7684 tag\uff0cpage offset \u5bf9\u5e94 byte offset\u3002</p> <p>\uff08\u4f46\u662f\u5b9e\u9645\u4e0a\uff0c\u6211\u4e2a\u4eba\u5e76\u4e0d\u8ba4\u540c\u628a virtual memory \u548c cache \u7c7b\u6bd4\u8d77\u6765\u3002\uff09</p>"},{"location":"5-x/#553-\u9875\u8868","title":"5.5.3 \u9875\u8868","text":"<p>\u6211\u4eec\u4e0b\u9762\u8ba8\u8bba\u8fd9\u79cd translation \u7684\u5177\u4f53\u65b9\u6848\u3002\u4e4b\u524d\u4e5f\u63d0\u5230\uff0cfully-associative \u7684\u4e00\u4e2a\u91cd\u8981\u95ee\u9898\u5c31\u662f\u5982\u4f55\u53bb\u5b9a\u4f4d\u67d0\u4e00\u9879\uff1b\u8fd9\u91cc\u6211\u4eec\u5f15\u5165 page table \u8fd9\u79cd\u7ed3\u6784\uff0c\u5b83\u88ab\u5b58\u653e\u5728 main memory \u4e2d\uff0c\u6bcf\u4e2a\u7a0b\u5e8f\uff08\u5b9e\u9645\u4e0a\u662f\u8fdb\u7a0b\uff0c\u4f46\u662f\u5199\u8bfe\u672c\u7684\u4eba\u597d\u50cf\u73b0\u5728\u5e76\u4e0d\u60f3\u5f15\u5165\u8fd9\u4e2a\u6982\u5ff5\uff09\u90fd\u6709\u4e00\u4e2a\u81ea\u5df1\u7684 page table\uff1b\u540c\u65f6\u786c\u4ef6\u4e0a\u6709\u4e00\u4e2a page table register \u4fdd\u5b58\u5f53\u524d\u8fdb\u7a0b\u8fd9\u4e2a\u9875\u8868\u7684\u5730\u5740\u3002</p> <p>\u4f7f\u7528\u9875\u8868\u65f6\uff0c\u6211\u4eec\u6839\u636e virtual page number \u627e\u5230\u5bf9\u5e94 page table entry, PTE \u5728 page table \u4e2d\u7684\u504f\u79fb\uff0c\u7136\u540e\u4e0e page table register \u76f8\u52a0\u5f97\u5230\u5bf9\u5e94 entry \u7684 physical address\uff0c\u4ece\u4e2d\u8bfb\u53d6\u5bf9\u5e94\u7684 entry\u3002\u5176\u5b9e\u5c31\u662f\u8bf4\uff0cpage table \u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c <code>page_table[i]</code> \u8868\u793a\u7b2c <code>i</code> \u4e2a virtual page \u5bf9\u5e94\u7684 physical page number\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6bcf\u4e2a entry \u4e2d\u5305\u542b\u4e86\u4e00\u4e2a valid bit \u548c physical page number\u3002\u5982\u679c valid bit = 1\uff0c\u90a3\u4e48\u8f6c\u6362\u5b8c\u6210\uff1b\u5426\u5219\u89e6\u53d1\u4e86 page fault\uff0chandle \u4e4b\u540e\u518d\u8fdb\u884c\u8f6c\u6362\u3002</p> <p></p> <p>Page fault \u4f1a\u5f15\u53d1\u4e00\u4e2a exception\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u63a5\u7ba1\u63a7\u5236\uff0c\u5904\u7406\u5b8c\u4e4b\u540e\u518d\u5c06\u63a7\u5236\u4ea4\u8fd8\u7ed9\u8fdb\u7a0b\u3002\u64cd\u4f5c\u7cfb\u7edf\u8981\u505a\u7684\u4e8b\u60c5\u662f\u5728 secondary storage \u4e2d\u627e\u5230\u8fd9\u4e00 page\uff0c\u5c06\u5176\u653e\u5230 main memory \u91cc\uff08\u53ef\u80fd\u9700\u8981\u4e0e\u5f53\u524d\u4e3b\u5b58\u4e2d\u7684\u67d0\u4e2a page \u4ea4\u6362\uff09\uff0c\u7136\u540e\u66f4\u65b0 page table\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u5728\u521b\u5efa\u8fdb\u7a0b\u65f6\u5728 disk (\u6216\u8005 flash memory) \u4e0a\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u5730\u5740\u7a7a\u95f4\u90a3\u4e48\u5927\u7684\u7a7a\u95f4\uff0c\u4ee5\u4fbf\u4e0a\u8ff0\u7684\u4ea4\u6362\uff1b\u8fd9\u4e2a\u7a7a\u95f4\u79f0\u4e3a \u4ea4\u6362\u533a, swap space\u3002\u4e0b\u9762\u7684\u95ee\u9898\u662f\u64cd\u4f5c\u7cfb\u7edf\u5982\u4f55\u5728 swap space \u4e2d\u627e\u5230\u9700\u8981\u7684 page\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c page table entry \u7684 valid bit \u4e3a 0\uff0c\u90a3\u4e48\u540e\u9762\u7684 physical page number \u662f\u6ca1\u6709\u7528\u5230\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u5b57\u6bb5\u5b58\u50a8\u5bf9\u5e94 page \u88ab\u4ea4\u6362\u5230\u4e86 disk \u7684\u54ea\u4e2a\u4f4d\u7f6e\uff1b\u6216\u8005\u53e6\u5916\u5f00\u8f9f\u4e00\u4e2a\u7d22\u5f15\u7ed3\u6784\uff0c\u5728\u5176\u4e2d\u8bb0\u5f55\u6bcf\u4e2a virtual page number \u5bf9\u5e94\u7684 disk \u4f4d\u7f6e\u3002\u4f5c\u4e3a\u524d\u8005\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u8bf7\u770b\u4e0b\u56fe\uff1a</p> <p></p> <p>\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u4f1a\u8ddf\u8e2a\u54ea\u4e9b\u8fdb\u7a0b\u548c\u865a\u62df\u5730\u5740\u6b63\u5728\u4f7f\u7528\u54ea\u4e2a\u7269\u7406\u9875\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u8ba9\u4ea4\u6362\u5f15\u53d1\u540e\u7eed page fault \u7684\u6b21\u6570\u5c3d\u53ef\u80fd\u5c11\u3002\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4f7f\u7528\u6211\u4eec\u4e4b\u524d\u63d0\u5230\u7684 LRU, Least Recently Used \u7684\u7b56\u7565\u5904\u7406\u4ea4\u6362\u3002</p> <p>LRU \u7684\u4ee3\u4ef7\u6709\u70b9\u592a\u5927\u4e86\uff0c\u6bd5\u7adf\u5982\u679c\u4f7f\u7528 LRU \u7684\u8bdd\u9700\u8981\u904d\u5386\u6574\u4e2a main memory\u3002\u56e0\u6b64\uff0c\u5f88\u591a\u64cd\u4f5c\u7cfb\u7edf\u5f15\u5165\u4e86 reference bit (\u6216\u8005\u79f0\u4e3a use bit) \u6765\u8fd1\u4f3c\u5730\u5b9e\u73b0 LRU\u3002\u5f53\u4e00\u4e2a page \u88ab\u8bbf\u95ee\u65f6\u8fd9\u4e2a bit \u88ab\u7f6e\u4e3a 1\uff1b\u64cd\u4f5c\u7cfb\u7edf\u5b9a\u671f\u5c06 reference bit \u6e05\u96f6\u3002\u56e0\u6b64\uff0c\u5728\u9700\u8981\u4ea4\u6362\u65f6\uff0c\u53ea\u9700\u8981\u627e\u4e00\u4e2a reference bit \u4e3a 0 \u7684\u5c31\u53ef\u4ee5\u8bf4\u660e\u5b83\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u6ca1\u6709\u88ab\u8bbf\u95ee\u8fc7\u3002</p> <p>\u5982\u6211\u4eec\u4e4b\u524d\u6240\u8bf4\uff0cvirtual memory \u4f7f\u7528 write back \u7684\u7b56\u7565\uff0c\u56e0\u6b64\u8fd8\u9700\u8981\u4e00\u4e2a dirty bit\u3002</p>"},{"location":"5-x/#554-\u7528\u591a\u7ea7\u9875\u8868\u89e3\u51b3\u9875\u8868\u8fc7\u5927\u7684\u95ee\u9898","title":"5.5.4 \u7528\u591a\u7ea7\u9875\u8868\u89e3\u51b3\u9875\u8868\u8fc7\u5927\u7684\u95ee\u9898","text":"<p>\u6211\u4eec\u4e0d\u59a8\u5173\u6ce8\u4e00\u4e0b page table \u6709\u591a\u5927\u3002\u5728\u6211\u4eec\u4e4b\u524d\u7684\u4f8b\u5b50\u4e2d\uff0cvirtual address \u6709 48 bit\uff0c\u6bcf\u4e2a page \u7684\u5927\u5c0f\u4e3a 4KiB\uff0c\u6240\u4ee5 page table entry \u7684\u6570\u76ee\u662f  \\(\\cfrac{2^{48} \\text{ B}}{4\\text{ KiB}} = \\cfrac{2^{48}}{4\\times 2^{10}} = 2^{36}\\)\uff1b\u800c RISC-V \u6bcf\u4e2a\u8868\u9879\u6709 8 Byte\uff0c\u6240\u4ee5 page table \u7684\u603b\u5927\u5c0f\u6765\u5230\u4e86 \\(2^{39}\\text{ B} = 0.5 \\text{TiB}\\)\uff0c\u8fd9\u662f\u6781\u5176\u4e0d\u5408\u7406\u7684\uff1b\u5c24\u5176\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a page table \u7684\u524d\u63d0\u4e0b\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u591a\u7ea7\u9875\u8868\u7684\u65b9\u5f0f\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u5982\u6211\u4eec\u4e4b\u524d\u6240\u8ff0\uff0c\u9875\u8868\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c  <code>page_table[i]</code>  \u4e2d\u5b58\u50a8\u7684\u662f page number \u4e3a i \u7684 page \u6240\u5bf9\u5e94\u7684 frame number\u3002\u8003\u8651\u6211\u4eec\u7684\u903b\u8f91\u5730\u5740\u7ed3\u6784\uff1a</p> <p></p> <p>\u8fd9\u6837\u7684\u903b\u8f91\u5730\u5740\u7ed3\u6784\u9700\u8981\u4e00\u4e2a\u5b58\u50a8 2p\u00a0\u4e2a\u5143\u7d20\u7684 page table\uff0c\u5373\u9700\u8981\u8fd9\u4e48\u5927\u7684\u8fde\u7eed\u5185\u5b58\uff0c\u8fd9\u662f\u975e\u5e38\u5927\u7684\u6d88\u8017\u3002\u6211\u4eec\u8003\u8651\u5c06 p \u518d\u5206\u4e3a p1\u00a0\u548c p2\u00a0\uff1a</p> <p></p> <p></p> <p>\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u4e24\u7ea7\u9875\u8868\uff0c  <code>outer_page_table[i]</code> \u00a0\u4e2d\u5b58\u50a8\u7684\u662f p1\u00a0\u4e3a i \u7684 inner page table\uff0c\u5373 <code>inner_page_table[i][]</code>  \u7684\u57fa\u5730\u5740\uff1b\u800c  <code>inner_page_table[i][j]</code>  \u4e2d\u5b58\u50a8\u7684\u5c31\u662f p1\u00a0\u4e3a i\uff0cp2\u00a0\u4e3a j \u7684 page \u5bf9\u5e94\u7684 frame number\uff0c\u5373 page number \u4e3a p1p2\u00a0\uff08\u6ca1\u6709\u5206\u5272\u65f6\u7684 p\uff09\u5bf9\u5e94\u7684 frame number\u3002</p> <p>\u8fd9\u91cc\uff0c\u6211\u4eec\u79f0 p1\u00a0\u4e3a page directory number\u00a0\uff0cp2\u00a0\u4e3a page table number\uff0cd \u4e3a page offset\u3002</p> <p></p> <p>\u8003\u8651\u8fd9\u6837\u505a\u7684\u597d\u5904\uff1ahierarchical paging \u5176\u5b9e\u5c31\u662f\u5bf9\u9875\u8868\u7684\u5206\u9875\uff08page the page table\uff09\u3002\u56e0\u6b64\uff0c\u5b83\u907f\u514d\u4e86 page table \u5fc5\u987b\u5904\u5728\u8fde\u7eed\u5185\u5b58\u7684\u95ee\u9898\uff0c\u8fd9\u4e00\u95ee\u9898\u5728 p\u00a0\u6bd4\u8f83\u5927\u65f6\u5c24\u5176\u4e25\u91cd\u3002</p> <p>\u53e6\u5916\uff0c\u8fd9\u6837\u505a\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\u53ef\u4ee5\u8282\u7701\u7a7a\u95f4\u3002\u6211\u4eec\u4e4b\u524d\u63d0\u5230\uff0c\u9875\u8868\u4e0d\u4e00\u5b9a\u4f1a\u5168\u90e8\u4f7f\u7528\uff1b\u5e76\u4e14\u7531\u4e8e\u903b\u8f91\u5730\u5740\u662f\u8fde\u7eed\u7684\uff0c\u56e0\u6b64\u7528\u5230\u7684\u9875\u8868\u9879\u4e5f\u662f\u8fde\u7eed\u7684\uff0c\u90fd\u6392\u5728\u9875\u8868\u7684\u5934\u90e8\u3002\u56e0\u6b64\u5982\u679c\u6211\u4eec\u91c7\u7528\u4e86\u4e8c\u7ea7\u9875\u8868\uff0c\u90a3\u4e48\u8bb8\u591a\u6392\u5728\u540e\u9762\u7684 inner page table \u5c06\u5b8c\u5168\u4e3a\u7a7a\uff1b\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4e0d\u7ed9\u8fd9\u4e9b inner page table \u5206\u914d\u7a7a\u95f4\uff0c\u5373\u6211\u4eec\u53ea\u5206\u914d\u6700\u5927\u7684 p1\u00a0\u90a3\u4e48\u591a\u4e2a inner page table\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u8282\u7701\u5f88\u591a\u7a7a\u95f4\u3002\u5373\u4f7f\u5728\u6700\u5dee\u7684\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u9875\u8868\u90fd\u88ab\u4f7f\u7528\u4e86\uff0c\u6211\u4eec\u7684\u9875\u8868\u6240\u7528\u7684\u603b\u6761\u76ee\u6570\u4e5f\u53ea\u6709 \\(2^{p_1}+2^{p_1}\\cdot 2^{p_2} = 2^{p_1} + 2^{p_1 + p_2}\\)\u00a0\u4e2a\uff0c\u53ea\u6bd4\u5355\u7ea7\u9875\u8868\u7ed3\u6784\u591a\u4e86 \\(2^{p_1}\\)\uff0c\u662f\u5b8c\u5168\u53ef\u4ee5\u63a5\u53d7\u7684\u3002</p> <p>\u7c7b\u4f3c\u5730\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u8ba1\u66f4\u591a\u7ea7\u7684\u9875\u8868\u3002\u4f8b\u5982\uff0c64 \u4f4d\u7684\u903b\u8f91\u5730\u5740\u7a7a\u95f4\u4f7f\u7528\u4e8c\u7ea7\u9875\u8868\u5c31\u662f\u4e0d\u591f\u7684\uff0c\u5426\u5219\u5b83\u7684\u9875\u8868\u5c31\u4f1a\u957f\u6210\u8fd9\u6837\uff1a</p> <p></p> <p>\u8fd9\u6837 outer page \u5c31\u4f1a\u8d85\u7ea7\u5927\u3002\u6211\u4eec\u53ef\u4ee5 page the outer page\uff1a</p> <p></p> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5efa\u7acb\u4e86\u4e00\u4e2a\u4e09\u7ea7\u9875\u8868\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u4e0d\u5fc5\u4f7f\u7528\u5168\u90e8\u7684 64 \u4f4d\uff0c\u5373\u6211\u4eec\u4e0d\u9700\u8981\u4e00\u4e2a 64 \u4f4d\u90a3\u4e48\u5de8\u5927\u7684 virtual address space\u3002AMD-64 \u652f\u6301 48-bit \u7684\u865a\u62df\u5730\u5740\uff0cARM64 \u652f\u6301 39-bit \u548c 48-bit \u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff1a</p> <p></p>"},{"location":"5-x/#555-\u4f7f\u7528-tlb-\u52a0\u5feb\u5730\u5740\u8f6c\u6362","title":"5.5.5 \u4f7f\u7528 TLB \u52a0\u5feb\u5730\u5740\u8f6c\u6362","text":"<p>\u6211\u4eec\u4e4b\u524d\u63d0\u5230\uff0c\u4f7f\u7528\u9875\u8868\u65f6\uff0c\u6211\u4eec\u6839\u636e virtual page number \u627e\u5230\u5bf9\u5e94 page table entry \u5728 page table \u4e2d\u7684\u504f\u79fb\uff0c\u7136\u540e\u4e0e page table register \u76f8\u52a0\u5f97\u5230\u5bf9\u5e94 entry \u7684 physical address\uff0c\u4ece\u4e2d\u8bfb\u53d6\u5bf9\u5e94\u7684 entry\u3002\u4f46\u662f\u8fd9\u79cd\u65b9\u6cd5\u7684\u6548\u7387\u5b58\u5728\u95ee\u9898\u3002\u8981\u8bbf\u95ee virtual address \u5bf9\u5e94\u7684 physical address\uff0c\u6211\u4eec\u9996\u5148\u8981\u6839\u636e page table register \u548c page number \u6765\u627e\u5230\u9875\u8868\u5728\u5185\u5b58\u7684\u4f4d\u7f6e\uff0c\u5e76\u5728\u5176\u4e2d\u5f97\u5230 page \u5bf9\u5e94\u7684 frame number\uff0c\u8fd9\u9700\u8981\u4e00\u6b21\u5185\u5b58\u8bbf\u95ee\uff1b\u7136\u540e\u6211\u4eec\u6839\u636e frame number \u548c page offset \u7b97\u51fa\u771f\u5b9e\u7684 physical address\uff0c\u5e76\u8bbf\u95ee\u5bf9\u5e94\u7684\u5b57\u8282\u5185\u5bb9\u3002\u5373\uff0c\u8bbf\u95ee\u4e00\u4e2a\u5b57\u8282\u9700\u8981\u4e24\u6b21\u5185\u5b58\u8bbf\u95ee\uff0c\u8fd9\u4f1a\u52a0\u500d\u539f\u672c\u7684\u5185\u5b58\u8bbf\u95ee\u7684\u65f6\u95f4\uff0c\u8fd9\u662f\u96be\u4ee5\u63a5\u53d7\u7684\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\u7528\u5230\u4e00\u4e2a\u4e13\u7528\u7684\u9ad8\u901f\u67e5\u627e\u786c\u4ef6 cache\uff0c\u8fd9\u91cc\u79f0\u5b83\u4e3a translation look-aside buffer (TLB)\u3002\u5b83\u5b9e\u9645\u4e0a\u5c31\u662f page table \u7684\u4e13\u7528 cache\uff08\u5b83\u771f\u7684\u662f cache\uff1bpage table \u5e76\u4e0d\u662f cache\uff0c\u53ea\u662f\u50cf cache\uff09\uff0c\u5176 associativity \u7684\u8bbe\u8ba1\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u51b3\u5b9a\u3002</p> <p>\u4e0b\u56fe\u662f\u4e00\u4e2a fully-associative \u7684 TLB \u7684\u4f8b\u5b50\uff1b\u7531\u4e8e\u662f fully-associative\uff0c\u5e76\u4e0d\u9700\u8981 index\uff1a</p> <p></p> <p>\u5f53 TLB miss \u7684\u65f6\u5019\uff0c\u5904\u7406\u5668\u53bb page table \u67e5\u627e\u5bf9\u5e94\u7684\u9879\uff1b\u5982\u679c\u53d1\u73b0\u5bf9\u5e94\u9879\u662f valid \u7684\uff0c\u90a3\u4e48\u5c31\u628a\u4ed6\u62ff\u5230 TLB \u91cc\uff08\u6b64\u65f6\u88ab\u66ff\u6362\u6389\u7684 TLB entry \u7684 dirty bit \u5982\u679c\u662f 1\uff0c\u4e5f\u8981\u5199\u4f1a page table\uff09\uff1b\u5426\u5219\u5c31\u4f1a\u89e6\u53d1\u4e00\u4e2a page fault\uff0c\u7136\u540e\u5728\u505a\u4e0a\u8ff0\u7684\u4e8b\u3002</p> <p></p>"},{"location":"5-x/#556-memory-protection","title":"5.5.6 Memory Protection","text":"<p>\u6682\u65f6\u4e0d\u60f3\u5b66QWQ</p>"},{"location":"5-x/#56-the-three-cs--\u5bf9-cache-miss-\u7684\u5f52\u7c7b","title":"5.6 The Three Cs | \u5bf9 cache miss \u7684\u5f52\u7c7b","text":"<p>Danger</p> <p>\u6b64\u5904\u5185\u5bb9\u5b58\u7591</p> <ul> <li>Compulsory misses / Cold-start misses\uff1a\u5bf9\u4e00\u4e2a\u5757\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u5f15\u53d1\u7684 miss</li> <li>Capacity misses\uff1a\u5728 fully-associative cache \u4e2d\uff0c\u67d0\u4e2a\u5757\u867d\u7136\u8bbf\u95ee\u8fc7\uff0c\u4f46\u662f\u7531\u4e8e\u5bb9\u91cf\u4e0d\u591f\u88ab\u6362\u51fa\u53bb\u4e86\uff0c\u518d\u8bbf\u95ee\u65f6\u5c31 miss \u4e86</li> <li>Conflict misses / Collision misses\uff1a\u5728 set-associative \u6216 direct-mapped cache \u4e2d\uff0c\u67d0\u4e2a\u5757\u867d\u7136\u8bbf\u95ee\u8fc7\uff0c\u4f46\u662f\u7531\u4e8e\u8fd9\u4e2a\u7ec4\u91cc\u7684\u5bb9\u91cf\u4e0d\u591f\u88ab\u6362\u51fa\u53bb\u4e86\uff0c\u518d\u8bbf\u95ee\u65f6\u5c31 miss \u4e86</li> </ul>"},{"location":"5-x/#57-using-fsm-to-control-a-simple-cache","title":"5.7 Using FSM to Control a Simple Cache","text":"<p>FSM\uff0cFinite State Machine\uff0c\u6709\u9650\u72b6\u6001\u81ea\u52a8\u673a\uff1b\u5176\u5b9e\u5c31\u662f\u6839\u636e\u5f53\u524d\u72b6\u6001\u548c\u8f93\u5165\u8f6c\u6362\u72b6\u6001\u7684\u4e1c\u897f\u3002\u8fd9\u91cc\u6839\u636e\u5f53\u524d\u7684\u72b6\u6001\u4ee5\u53ca\u53d1\u751f\u7684\u4e8b\u4ef6\u8f6c\u6362\u72b6\u6001\uff0c\u5e76\u7ed9\u51fa\u4e00\u4e9b\u63a7\u5236\u4fe1\u53f7\u7684\u8f93\u51fa\uff1a</p> <p></p> <p></p>"},{"location":"6-x/","title":"6 \u8f93\u5165/\u8f93\u51fa | I/O","text":"<p> \u7ea6 6 \u4e2a\u5b57 </p>"},{"location":"A-exams/","title":"\u5173\u4e8e\u8003\u8bd5","text":"<p> \u7ea6 551 \u4e2a\u5b57  18 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p>"},{"location":"A-exams/#2022-\u671f\u672b\u56de\u5fc6\u5377","title":"2022 \u671f\u672b\u56de\u5fc6\u5377","text":""},{"location":"A-exams/#\u9009\u62e9\u9898","title":"\u9009\u62e9\u9898","text":"<ul> <li>\u7ed9\u673a\u5668\u7801\u7ffb\u8bd1\u6210\u6307\u4ee4</li> <li>\u7ed932\u4f4d\u5927\u7acb\u5373\u6570\u5730\u5740\u53d6\u51fa\u5176\u4e2d\u5185\u5bb9\uff08lui+lw\uff09</li> <li>\u6d6e\u70b9\u6570\u52a0\u6cd5\u8fc7\u7a0b\uff1a\\(0.12345 \\times 10^2\\) \u548c \\(0.12345 \\times 10^{-2}\\) \u5bf9\u9f50\u540e 10 \u7684\u5e42\u6b21\u662f\u591a\u5c11</li> <li>\u56db\u4e2a\u9009\u9879\u9009\u5bf9\u7684\uff1a<ul> <li>PTE \u6570=\u7269\u7406\u9875\u6570</li> <li>\u589e\u52a0 associativity \u53ef\u4ee5\u51cf\u5c11 capa miss</li> <li>async bus \u7684\u6982\u5ff5</li> <li>\u5185\u5b58\u7ed3\u6784\u4e2d\u8017\u65f6\u6700\u591a\u7684\u662f\u6700\u4e0a\u5c42</li> </ul> </li> <li>IEEE 754\uff1a\\(1.355-2.105\\) \u7528\u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570\u8868\u793a</li> <li>\u5355\u5468\u671f\u7684\u65f6\u5019\u65f6\u949f\u5468\u671f\u5b8c\u4e0d\u6210\u54ea\u4e2a\u5de5\u4f5c(\u8bfb\u5e76\u5199\u5185\u5b58)</li> <li>TLB \u6709 tlb \u7684\u65f6\u5019\u5148\u770b\u8c01\uff1atlb pgtbl cache phymem</li> <li>RAID \u662f\u5e72\u5565\u7684</li> <li>cache \u589e\u5927 block size \u53ef\u4ee5\u51cf\u5c11\u54ea\u79cd miss</li> <li>write through \u6307\u4ec0\u4e48</li> <li>6 \u4e2a block\uff0c\u6bcf\u4e2a block 4words\uff0c\u6c42 840 \u5bf9\u5e94\u7684 block \u53f7</li> </ul>"},{"location":"A-exams/#\u5927\u9898","title":"\u5927\u9898","text":""},{"location":"A-exams/#1","title":"1","text":"<p>(1) \u628a\u8fd96\u4e2a\u6570\u6392\u5e8f\uff1a\u5728\u539f\u7801\u3001\u8865\u7801\u3001\u7b26\u53f7\u8868\u793a\u3001IEEE754 \u4e0b\u7684 0xF0000000\uff0c\u5728\u539f\u7801\u3001\u8865\u7801\u4e0b\u7684 0xFFFFFFFF</p> <p>(2) \u4e0d\u7528\u522b\u7684\u5bc4\u5b58\u5668\uff0c\u4ea4\u6362 x10 \u548c x11</p> <p>(3) \u4e66\u4e0aIndexOutOfBound \u90a3\u4e2a\u4f8b\u5b50\uff0c\u5224\u65ad\u6570\u7ec4\u8d8a\u754c</p>"},{"location":"A-exams/#2-\u5199\u6c47\u7f16","title":"2 \u5199\u6c47\u7f16","text":"<pre><code>void main(char *s,int *n){\n     char c,ch;\n     c = '3';\n     ch = '5';\n     *n = replace(*s,c,ch);\n}\n\nint replace(char *u,char c,char ch){\n     int i = 0;\n     while(u[i]!=0){\n          if(u[i]==c){\n                u[i]=ch;\n                break;\n          }\n          i++;\n     }\n     return i;\n}\n</code></pre>"},{"location":"A-exams/#3-cache\u4e0d\u786e\u5b9a\u5b8c\u5168\u4e00\u81f4","title":"3 cache(\u4e0d\u786e\u5b9a\u5b8c\u5168\u4e00\u81f4)","text":"<p>(1) 32B \u7684 cache\uff0c\u4e00\u4e2a entry 8B\uff0c\u76f4\u63a5\u6620\u5c04\uff0cwrite through+write around\uff0c\u7ed9\u51fa\u5982\u4e0b\u8bbf\u95ee\uff1a0 16 48 8 56 16 8 56 32 0 60\uff0c\u95ee\u6bcf\u4e00\u6b21\u7684 index, tag, \u662f\u5426 hit(\u6ce8\u610f write around)</p> <p>(2) 128B \u7684 cache\uff0c\u4e00\u4e2a entry 16B\uff0c2 \u8def\u7ec4\u5173\u8054 LRU\uff0cwrite back\uff0c\u7ed9\u51fa\u8bbf\u95ee\uff1a64 32 64 0 112 64 128 48 240 0\uff0c\u95ee\u7684\u8ddf\u4e0a\u9762\u4e00\u6837\uff0c\u5916\u52a0\u6700\u540e\u7684 dirty block number</p>"},{"location":"A-exams/#4-\u865a\u62df\u5185\u5b58","title":"4 \u865a\u62df\u5185\u5b58","text":"<p>\u9875\u8868\u5927\u5c0f\uff0c\u4ee5\u53ca\u7ed9\u5b9a\u60c5\u51b5\u95ee TLB \u80fd\u4e0d\u80fd\u5bb9\u7eb3 8MiB \u5185\u5b58</p>"},{"location":"A-exams/#5-\u6d41\u6c34\u7ebf","title":"5 \u6d41\u6c34\u7ebf","text":"<p>(1)\u5148\u95ee\u4e86 sub \u7684\u65f6\u5019\u9664\u4e86 ALUOp \u4ee5\u5916\u5404\u4e2a\u4fe1\u53f7\u7684\u503c</p> <p>\u7ed9\u4e86\u4e00\u6bb5\u4ee3\u7801\uff0c\u5e94\u8be5\u662f</p> <pre><code>sub x5,x7,x11  \nld x13, 0(x5)  \nld x7,0(x2)  \nadd x13,x5,x13  \nsd x13, 0(x5)\n</code></pre> <p>\u95ee\uff1a</p> <p>(2) \u5982\u679c\u6ca1\u6709 forward \u548c hazard detection\uff0c\u5728\u4ee3\u7801\u63d2 nop \u4f7f\u5176\u80fd\u6b63\u786e   (3) \u5982\u679c\u6709 forward \u6ca1\u6709 hazard detection\uff0c\u5e72(2)\u7684\u4e8b   (4) \u5982\u679c\u6709 forward\uff0c\u5199\u524d7\u4e2a\u65f6\u949f\u5468\u671f ForwardA \u548c ForwardB \u7684\u4fe1\u53f7\u503c</p>"},{"location":"A-exams/#\u5386\u5e74\u5377","title":"\u5386\u5e74\u5377","text":"<ul> <li>https://www.cc98.org/topic/5114223</li> <li>https://www.cc98.org/topic/5118209</li> </ul>"},{"location":"A-exams/#\u5c0f\u8003\u70b9","title":"\u5c0f\u8003\u70b9","text":"<ul> <li>Intro &amp; Misc</li> <li>Instructions<ul> <li>machine code</li> <li>addressing method</li> <li>floating point inst</li> </ul> </li> <li>Arithmetic<ul> <li>1's complement, 2's complement</li> <li>sign extensions</li> <li>floating point calc steps</li> <li>what is underflow</li> <li>IEEE 754 </li> </ul> </li> <li>Processor</li> <li>Cache<ul> <li>write-through, etc.</li> </ul> </li> <li>Virtual Memory<ul> <li>TLB</li> <li>usage of dirty bit</li> </ul> </li> <li>I/O<ul> <li>SCSI Bus, etc.</li> <li>memory-mapped I/O system</li> </ul> </li> </ul>"},{"location":"A-exams/#\u5927\u9898_1","title":"\u5927\u9898","text":"<ul> <li>\u7ed9 C \u5199\u6c47\u7f16 [19(14)]</li> <li>Cache \u7b97\u4f4d\u6570 [19(12)]</li> </ul> <p>  D</p>"}]}